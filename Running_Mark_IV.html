<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <link href="style.css" rel="stylesheet">
  <link href="favicon.ico" rel="icon" sizes="32x32">
  <title>
   Running Mark IV&mdash;ConTeXt Wiki Mirror
  </title>
  <link href="https://wiki.contextgarden.net/Running_Mark_IV" rel="canonical">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="#241504" name="theme-color">
  <meta content="light dark" name="color-scheme">
 </head>
 <body>
  <header>
   <h1 id="page-title">
    Running Mark IV
   </h1>
   <p>Unofficial <a href="https://wiki.contextgarden.net/">ConTeXt Wiki</a> mirror</p>
   <p>Last modified: <a href="https://wiki.contextgarden.net/index.php?curid=2608&diff=40685">2025-01-15</a>
        </p>
  </header>
  <article>
   <div class="mw-parser-output">
    <div class="toc" id="toc">
     <input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox">
     <div class="toctitle" dir="ltr" lang="en">
      <h2>
       Contents
      </h2>
      <span class="toctogglespan">
       <label class="toctogglelabel" for="toctogglecheckbox">
       </label>
      </span>
     </div>
     <ul>
      <li class="toclevel-1 tocsection-1">
       <a href="#Introduction">
        <span class="tocnumber">
         1
        </span>
        <span class="toctext">
         Introduction
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-2">
       <a href="#History">
        <span class="tocnumber">
         2
        </span>
        <span class="toctext">
         History
        </span>
       </a>
       <ul>
        <li class="toclevel-2 tocsection-3">
         <a href="#Special_notes_.28TL_2008.2F2009.29:">
          <span class="tocnumber">
           2.1
          </span>
          <span class="toctext">
           Special notes (TL 2008/2009):
          </span>
         </a>
        </li>
        <li class="toclevel-2 tocsection-4">
         <a href="#Special_notes_.28TL_2010.29:">
          <span class="tocnumber">
           2.2
          </span>
          <span class="toctext">
           Special notes (TL 2010):
          </span>
         </a>
        </li>
       </ul>
      </li>
      <li class="toclevel-1 tocsection-5">
       <a href="#Quickstart">
        <span class="tocnumber">
         3
        </span>
        <span class="toctext">
         Quickstart
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-6">
       <a href="#Generating_and_updating_formats">
        <span class="tocnumber">
         4
        </span>
        <span class="toctext">
         Generating and updating formats
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-7">
       <a href="#Experimental_speedup">
        <span class="tocnumber">
         5
        </span>
        <span class="toctext">
         Experimental speedup
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-8">
       <a href="#Using_fonts">
        <span class="tocnumber">
         6
        </span>
        <span class="toctext">
         Using fonts
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-9">
       <a href="#Downloaded_files">
        <span class="tocnumber">
         7
        </span>
        <span class="toctext">
         Downloaded files
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-10">
       <a href="#In_case_of_trouble">
        <span class="tocnumber">
         8
        </span>
        <span class="toctext">
         In case of trouble
        </span>
       </a>
       <ul>
        <li class="toclevel-2 tocsection-11">
         <a href="#File_not_found_.28TL_2008.2F2009.29">
          <span class="tocnumber">
           8.1
          </span>
          <span class="toctext">
           File not found (TL 2008/2009)
          </span>
         </a>
        </li>
       </ul>
      </li>
      <li class="toclevel-1 tocsection-12">
       <a href="#Cache_internals">
        <span class="tocnumber">
         9
        </span>
        <span class="toctext">
         Cache internals
        </span>
       </a>
      </li>
     </ul>
    </div>
    <h2>
     <span class="mw-headline" id="Introduction">
      Introduction
     </span>
    </h2>
    <p>ConTeXt <a href="ConTeXt_and_Lua_programming/ConTeXt_Development/Mark_IV.html" title="ConTeXt and Lua programming/ConTeXt Development/Mark IV">Mark IV</a> does not use the kpathsea library to find files and configuration settings. It follows that running mktexlsr or fmtutil has no effect. This page explains the details of 
setting up and maintaining <a href="ConTeXt_and_Lua_programming/ConTeXt_Development/Mark_IV.html" title="ConTeXt and Lua programming/ConTeXt Development/Mark IV">Mark IV</a>.
</p>
    <h2>
     <span class="mw-headline" id="History">
      History
     </span>
    </h2>
    <p>The most important original motivation for this page was that the <a class="mw-redirect" href="TeX_Live_2011.html" title="TeX Live">TeX Live</a> 2008 edition contained Mark IV, but it was only copied to the installed system, no post-install setup took place at all. For the Tex Live 2008 release, the post-install setup had to be done manually. TeX Live 2009 did not come with a usable Mark IV at all because the luatex on the 2009 editions was too old compared to the ConTeXt version. Instructions on how to deal with TeX Live 2009 were needed then.  TeX Live 2010 has a working Context Mark IV out of the box: you can just run 'context' directly.  At most, you could run <code>luatools --generate; context --make</code> to deal with any tlmgr updates you may have performed since installing TeX Live. 
</p>
    <p>In TeX Live 2011, not even that is needed and you only have to run <code>mtxrun --generate</code> when files are installed manually <i>outside</i> of tlmgr. If you are running tl 2011, this page is just background information, there should be no need to take actual actions.
</p>
    <h3>
     <span id="Special_notes_(TL_2008/2009):">
     </span>
     <span class="mw-headline" id="Special_notes_.28TL_2008.2F2009.29:">
      Special notes (TL 2008/2009):
     </span>
    </h3>
    <ul>
     <li>
      <b>
       Windows
      </b>
      : Running Mark IV under Windows is the same as on Unix, but see
      <a href="Running_Mark_IV#In_case_of_trouble.html" title="Running Mark IV">
       below
      </a>
      for a installation hints for the 'spaces in names' problem that seem to affect Windows users more often than other platforms.
     </li>
    </ul>
    <ul>
     <li>
      <b>
       Debian
      </b>
      : Mark IV suggests the tex-gyre package (
      <a href="TeX_Gyre_-_Old_Content.html" title="TeX Gyre - Old Content">
       TeX Gyre - Old Content
      </a>
      ), not distributed currently under Debian due to licensing issues (see
      <a href="Debian_installation.html" title="Debian installation">
       Debian installation
      </a>
      )
     </li>
    </ul>
    <h3>
     <span id="Special_notes_(TL_2010):">
     </span>
     <span class="mw-headline" id="Special_notes_.28TL_2010.29:">
      Special notes (TL 2010):
     </span>
    </h3>
    <ul>
     <li>
      <b>
       <a class="new" href="index.php?title=MacTeX&action=edit&redlink=1" title="MacTeX (page does not exist)">
        MacTeX
       </a>
      </b>
      : You need to
      <a href="Running_Mark_IV#Updating_ConTeXt.html" title="Running Mark IV">
       update
      </a>
      ConTeXt first.
     </li>
    </ul>
    <h2>
     <span class="mw-headline" id="Quickstart">
      Quickstart
     </span>
    </h2>
    <p>If you have trouble following these instructions, please direct you questions or complaints on the <a class="external text" href="http://www.ntg.nl/mailman/listinfo/ntg-context" rel="nofollow">ntg-context mailing list</a>, <b>not</b> the tex-live list.
</p>
    <p>Just for the extremely impatient unix user that knows how to deal with a web2c-based TeX distribution and has a simple, private (single-user) installation, this is the only absolutely required extra knowledge:
</p>
    <pre> luatools --generate        # 2010 and earlier
</pre>
    <p>or 
</p>
    <pre> mtxrun --generate          # 2011
</pre>
    <p>is the Mark IV replacement for mktexlsr.
</p>
    <pre> context --make
</pre>
    <p>is the Mark IV replacement for fmtutil.
</p>
    <pre> context myfile.tex
</pre>
    <p>typesets a file.
</p>
    <p>Everybody else should read on.
</p>
    <p><b>A note for windows users: (tl2008/2009)</b> the luatex executable does not accept filenames with spaces in their name. This means that if you are on windows you will at least have to set up a texmfcnf.lua as explained below, and you likely will even have to reinstall texlive, because the default texlive installation directory itself contains spaces. <a href="Running_Mark_IV#File_not_found.html" title="Running Mark IV"> Details</a>.
</p>
    <h2>
     <span class="mw-headline" id="Generating_and_updating_formats">
      Generating and updating formats
     </span>
    </h2>
    <p>Before first use and after each update to either the <a class="new" href="index.php?title=ConTeXt&action=edit&redlink=1" title="ConTeXt (page does not exist)">ConTeXt</a> distribution or the <a class="new" href="index.php?title=luatex&action=edit&redlink=1" title="luatex (page does not exist)">luatex</a> executable you will have to regenerate the formats. The manual command for that is:
</p>
    <pre> context --make cont-en
</pre>
    <p>This will generate a new Mark IV format with the English interface.  Without an explicit format argument, it will generate four formats: Mark IV cont-en, Matk IV cont-nl, luatex+mptopdf, and luatex+plain.
</p>
    <p>Starting with 2011, formats are automatically (re)generated by <code>context myfile.tex</code> when it believes it is necessary to do so. Specifically: assuming the format already exists, automatic regeneration takes places whenever the ConTeXt version of the luatex version do not match the ones in the pre-existing format. Manual patches of the core files still require manual regeneration of the formats.
</p>
    <p>The generated formats are stored inside the texmf cache.
</p>
    <h2>
     <span class="mw-headline" id="Experimental_speedup">
      Experimental speedup
     </span>
    </h2>
    <p>In addition to standard <a class="new" href="index.php?title=luatex&action=edit&redlink=1" title="luatex (page does not exist)">luatex</a> we provide <a class="new" href="index.php?title=luajittex&action=edit&redlink=1" title="luajittex (page does not exist)">luajittex</a> which uses just in time compilation to speed up processing. The speedup is mostly due to the faster virtual machine. The exact speedup depends on the tex/lua ratio and we measured speedups between 10% and 40%. You force this engine with  
</p>
    <pre> context --jit ....
</pre>
    <p>Alternatively you can put 
</p>
    <pre class="tex"><span class="comment">% engine=luajittex</span>
</pre>
    <p>on top of your main document source. 
</p>
    <h2>
     <span class="mw-headline" id="Using_fonts">
      Using fonts
     </span>
    </h2>
    <p>The <code>OSFONTDIR</code> environment variable should contain the paths where the system fonts must be looked for.
</p>
    <p>See <a href="Characters_words_and_fonts/Fonts_in_LuaTeX#Getting_access_to_the_system_fonts.html" title="Characters words and fonts/Fonts in LuaTeX">Characters words and fonts/Fonts in LuaTeX#Getting access to the system fonts</a>
</p>
    <h2>
     <span class="mw-headline" id="Downloaded_files">
      Downloaded files
     </span>
    </h2>
    <p>If you have the program 'curl' installed, then your input file can contain e.g.
</p>
    <pre class="tex"><span class="cs"><span class="documentcs">\externalfigure</span></span>
  <span class="brx">[</span>http://www.pragma-ade.nl/show-gra.pdf<span class="brx">]</span>
</pre>
    <p>and the referenced file will be downloaded automatically and placed in the 'texmf cache' if is not found in the cache already.
</p>
    <h2>
     <span class="mw-headline" id="In_case_of_trouble">
      In case of trouble
     </span>
    </h2>
    <h3>
     <span id="File_not_found_(TL_2008/2009)">
     </span>
     <span class="mw-headline" id="File_not_found_.28TL_2008.2F2009.29">
      File not found (TL 2008/2009)
     </span>
    </h3>
    <ul>
     <li>
      You may get errors like
     </li>
    </ul>
    <pre> I can't find file `C:/Program.tex'.
</pre>
    <p>This is likely caused by the luatex executable not handling filename quoting properly yet. If filenames with spaces work at all, you are just lucky.
</p>
    <p>This problem is most likely to happen on Windows. There two steps to deal with it:
</p>
    <ul>
     <li>
      You must put the main texmf tree in path without spaces. If you're installing Mark IV via TeXLive 2008, then simply change the top installation path at install time.
     </li>
     <li>
      If you're running XP or Server 2003 (and not Vista or Server 2008), you must also set the TeX user home and the Lua cache to paths without spaces.
      <code>C:/tlhome</code>
      is a good candidate.
      <ul>
       <li>
        In
        <code>texmf.cnf</code>
        set TEXMFHOME to
        <code>C:/tlhome/$USERNAME</code>
        or to something similar of your liking. Using $USERNAME in the path will still give a per-user directory, just not under "Documents and Settings". This assumes that the user name doesn't have spaces of course...
       </li>
       <li>
        As mentioned above, create/edit
        <code>texmfcnf.lua</code>
        and put a line like
        <code>return { TEXMFCACHE =  'C:/tlhome/$USERNAME/.texlive2008/texmf-var' }</code>
        , which sets each user's cache inside his space-free TeX home path.
       </li>
      </ul>
     </li>
    </ul>
    <h2>
     <span class="mw-headline" id="Cache_internals">
      Cache internals
     </span>
    </h2>
    <p>(this paragraph is for developers and power-users only)
</p>
    <p>If you look at the folder that TEXMFCACHE points to, you will see a folder named luatex-cache. Inside that, there is the folder context. Inside the context folder, there usually is a single subfolder with a hexadecimal name. This is the md5sum of the name of the 'tex root' location (to be precise, it is the md5sum of the full path expansion of the context lua equivalent of the TEXMFCNF variable). 
</p>
    <p>Below this, there are currently four folders:
</p>
    <ul>
     <li>
      <b>
       curl
      </b>
      contains downloaded files. The url is converted to something that can be represented  on disk by replacing problematic characters by dashes
     </li>
     <li>
      <b>
       fonts
      </b>
      contains the file data/names.tma, this is the 'font name database' (and the derived names.tmc, tmc files are byte-compiled lua code for faster loading). There are also subdirectories containing the preprocessed metrics for non-tex fonts, one folder for each font type.
     </li>
     <li>
      <b>
       formats
      </b>
      contains the Mark IV format file
     </li>
     <li>
      <b>
       trees
      </b>
      has a small set of files with hexadecimal names, one for each of the top-level constituents of TEXMF (containing the filename database for that tree), and one for each of the found texmf.cnf files (containing in preprocessed form all the variables defined by that file). The filenames are md5sums of the contained directory or filename.
     </li>
    </ul>
   </div>
  </article>
  <footer>
   <ul role="list">
    <li>
     <a href="index.html">
      Home
     </a>
    </li>
    <li>
     Mirrored on 2026-01-15
    </li>
    <li>
     <a href="http://www.gnu.org/copyleft/fdl.html" rel="license">
      GFDL 1.2
     </a>
    </li>
    <li>
     <a href="https://wiki.contextgarden.net/Running_Mark_IV">
      Original page
     </a>
    </li>
   </ul>
  </footer>
 </body>
</html>
