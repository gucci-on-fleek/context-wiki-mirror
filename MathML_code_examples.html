<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <link href="style.css" rel="stylesheet">
  <link href="favicon.ico" rel="icon" sizes="32x32">
  <title>
   MathML code examples&mdash;ConTeXt Wiki Mirror
  </title>
  <link href="https://wiki.contextgarden.net/MathML_code_examples" rel="canonical">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="#241504" name="theme-color">
  <meta content="light dark" name="color-scheme">
 </head>
 <body>
  <header>
   <h1 id="page-title">
    MathML code examples
   </h1>
   <p>Unofficial <a href="https://wiki.contextgarden.net/">ConTeXt Wiki</a> mirror</p>
   <p>Last modified: <a href="https://wiki.contextgarden.net/index.php?curid=996&diff=39777">2025-01-12</a>
        </p>
  </header>
  <article>
   <div class="mw-parser-output">
    <p>&lt; <a href="Mathematics.html" title="Mathematics">Mathematics</a> | <a href="MathML.html" title="MathML">MathML</a> | <a href="Input_and_compilation/XML_source.html" title="Input and compilation/XML source">XML</a> &gt;
</p>
    <div class="toc" id="toc">
     <input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox">
     <div class="toctitle" dir="ltr" lang="en">
      <h2>
       Contents
      </h2>
      <span class="toctogglespan">
       <label class="toctogglelabel" for="toctogglecheckbox">
       </label>
      </span>
     </div>
     <ul>
      <li class="toclevel-1 tocsection-1">
       <a href="#MKII">
        <span class="tocnumber">
         1
        </span>
        <span class="toctext">
         MKII
        </span>
       </a>
       <ul>
        <li class="toclevel-2 tocsection-2">
         <a href="#Current_bugs_and_workarounds">
          <span class="tocnumber">
           1.1
          </span>
          <span class="toctext">
           Current bugs and workarounds
          </span>
         </a>
        </li>
       </ul>
      </li>
      <li class="toclevel-1 tocsection-3">
       <a href="#MKIV">
        <span class="tocnumber">
         2
        </span>
        <span class="toctext">
         MKIV
        </span>
       </a>
      </li>
     </ul>
    </div>
    <h2>
     <span class="mw-headline" id="MKII">
      MKII
     </span>
    </h2>
    <p>Here is a complete and simple example of a ConTeXt file including MathML for MKII:
</p>
    <pre class="xml">\usemodule[mathml]
\starttext
\startXMLdata
<span class="br">&lt;</span><span class="name">math</span><span class="br">&gt;</span>
 <span class="br">&lt;</span><span class="name">mrow</span><span class="br">&gt;</span>
  <span class="br">&lt;</span><span class="name">msup</span><span class="br">&gt;</span> <span class="br">&lt;</span><span class="name">mi</span><span class="br">&gt;</span>x<span class="br">&lt;</span><span class="name">/mi</span><span class="br">&gt;</span><span class="br">&lt;</span><span class="name">mn</span><span class="br">&gt;</span>2<span class="br">&lt;</span><span class="name">/mn</span><span class="br">&gt;</span> <span class="br">&lt;</span><span class="name">/msup</span><span class="br">&gt;</span>
  <span class="br">&lt;</span><span class="name">mo</span><span class="br">&gt;</span>+<span class="br">&lt;</span><span class="name">/mo</span><span class="br">&gt;</span>
  <span class="br">&lt;</span><span class="name">mrow</span><span class="br">&gt;</span>
    <span class="br">&lt;</span><span class="name">mn</span><span class="br">&gt;</span>4<span class="br">&lt;</span><span class="name">/mn</span><span class="br">&gt;</span><span class="br">&lt;</span><span class="name">mo</span><span class="br">&gt;</span>InvisibleTimes;<span class="br">&lt;</span><span class="name">/mo</span><span class="br">&gt;</span><span class="br">&lt;</span><span class="name">mi</span><span class="br">&gt;</span>x<span class="br">&lt;</span><span class="name">/mi</span><span class="br">&gt;</span>
  <span class="br">&lt;</span><span class="name">/mrow</span><span class="br">&gt;</span>
  <span class="br">&lt;</span><span class="name">mo</span><span class="br">&gt;</span>+<span class="br">&lt;</span><span class="name">/mo</span><span class="br">&gt;</span>
  <span class="br">&lt;</span><span class="name">mn</span><span class="br">&gt;</span>4<span class="br">&lt;</span><span class="name">/mn</span><span class="br">&gt;</span>
 <span class="br">&lt;</span><span class="name">/mrow</span><span class="br">&gt;</span>
<span class="br">&lt;</span><span class="name">/math</span><span class="br">&gt;</span>
\stopXMLdata
\stoptext
</pre>
    <p>That gives:
</p>
    <ul class="demo">
     <li class="rendering">
      <img height="13" src="wikiteximage/445248ec29405fe578d5ddd2e5ec6441.webp" width="55">
     </li>
    </ul>
    <p>MathML support in ConTeXt is very extensive, but some features are rather hidden for now. 
</p>
    <p><tt><a class="new" href="index.php?title=Command/setupMMLappearance&action=edit&redlink=1.html" title="Command/setupMMLappearance (page does not exist)">\setupMMLappearance</a></tt> allows you to adjust various things. For example, the layout of presentational markup which uses mtables for alignment can be changed via <tt><a class="new" href="index.php?title=Command/b&action=edit&redlink=1.html" title="Command/b (page does not exist)">\bc</a>]</tt>. Experiment with the different alternatives to see the effects.
</p>
    <p>When embedding XML inside normal ConTeXt code, remember that <tt><a class="new" href="index.php?title=Command/stopXMLdata&action=edit&redlink=1.html" title="Command/stopXMLdata (page does not exist)">\stopXMLdata</a></tt> gobbles up any following white-space. You'll need to explicitly put it back in if you want it (with <tt><a href="Command/space.html" title="Command/space">\space</a></tt>).
</p>
    <h3>
     <span class="mw-headline" id="Current_bugs_and_workarounds">
      Current bugs and workarounds
     </span>
    </h3>
    <p>To use UTF inside MathML currently requires this workaround:
</p>
    <pre class="tex"><span class="cs"><span class="systemcs">\unprotect</span></span>

<span class="cs">\long</span><span class="cs">\def</span><span class="cs">\doXMLremapdata</span><span class="brx">[</span><span class="brx">#</span>1<span class="brx">]</span><span class="brx">#</span>2<span class="brx">#</span>3<span class="brx">#</span>4<span class="comment">%</span>
  <span class="br">{</span><span class="cs">\bgroup</span>
   <span class="cs">\startXMLmapping</span><span class="brx">[</span><span class="brx">#</span>1<span class="brx">]</span><span class="comment">%</span>
   <span class="comment">% enable unknown elements (should be macro)</span>
   <span class="cs"><span class="systemcs">\doifsomething</span></span><span class="br">{</span><span class="brx">#</span>1<span class="br">}</span>
     <span class="br">{</span><span class="cs"><span class="systemcs">\doifdefinedelse</span></span><span class="br">{</span><span class="cs">\@@XML</span><span class="brx">#</span>1:<span class="protectedcs">\s!unknown</span>:M<span class="br">}</span>
        <span class="br">{</span><span class="cs">\remapXMLunknowntrue</span><span class="br">}</span><span class="br">{</span><span class="cs">\remapXMLunknownfalse</span><span class="br">}</span><span class="br">}</span><span class="comment">%</span>
   <span class="comment">%</span>
   <span class="cs"><span class="systemcs">\pushmacro</span></span><span class="cs">\doXMLentity</span> <span class="comment">% needed&nbsp;?</span>
   <span class="comment">% this will change, proper split in element itself</span>
   <span class="cs">\ifx</span><span class="cs">\currentXMLnamespace</span><span class="cs">\empty</span>
     <span class="cs">\let</span><span class="cs">\parseXMLelement</span><span class="cs">\remapXMLelement</span>
   <span class="cs">\else</span>
     <span class="comment">% here we need to get rid of the namespace; we also</span>
     <span class="comment">% have to preserve the leaqding / if present</span>
     <span class="cs">\@EA</span><span class="cs">\long</span><span class="cs">\@EA</span><span class="cs">\def</span><span class="cs">\@EA</span><span class="cs">\parseXMLelement</span><span class="cs">\@EA</span>
       <span class="brx">#</span><span class="brx">#</span><span class="cs">\@EA</span>1<span class="cs">\currentXMLnamespace</span>:<span class="br">{</span><span class="cs">\remapXMLelement</span><span class="brx">#</span><span class="brx">#</span>1<span class="br">}</span><span class="comment">%</span>
     <span class="comment">% ##2 removes leading spaces</span>
   <span class="cs">\fi</span>
   <span class="comment">%</span>
   <span class="cs">\let</span><span class="cs">\parseXMLescape</span> <span class="cs">\remapXMLescape</span>
   <span class="cs">\let</span><span class="cs">\parseXMLprocess</span><span class="cs">\remapXMLprocess</span>
   <span class="comment">%</span>
   <span class="cs">\let</span><span class="cs">\doXMLentity</span>    <span class="cs">\remapXMLentity</span>
   <span class="comment">%</span>
   <span class="cs">\enableXML</span> <span class="comment">% sets entities</span>
   <span class="cs">\enableXMLexpansion</span>
   <span class="cs">\let</span><span class="cs">\par</span><span class="cs">\XMLremappedpar</span>
   <span class="cs">\the</span><span class="cs">\everyXMLremapping</span>
   <span class="comment">%\ignorelines</span>
   <span class="cs">\catcode</span>`\^^I<span class="brx">=</span><span class="cs">\@@space</span>
   <span class="cs">\catcode</span>`\^^M<span class="brx">=</span><span class="cs">\@@space</span>
   <span class="cs">\catcode</span>`\^^L<span class="brx">=</span><span class="cs">\@@space</span>
   <span class="cs">\catcode</span>`\^^Z<span class="brx">=</span><span class="cs">\@@space</span>
<span class="cs"><span class="systemcs">\pushmacro</span></span><span class="cs">\unicodechar</span>
<span class="cs">\let</span><span class="cs">\unicodechar</span><span class="cs">\relax</span>
   <span class="cs">\xdef</span><span class="cs">\remappedXMLdata</span><span class="br">{</span><span class="brx">#</span>4<span class="cs">\empty</span><span class="br">}</span><span class="comment">%</span>
<span class="cs"><span class="systemcs">\popmacro</span></span><span class="cs">\unicodechar</span>
   <span class="cs">\let</span><span class="cs">\par</span><span class="cs">\endgraf</span>
   <span class="cs"><span class="systemcs">\popmacro</span></span><span class="cs">\doXMLentity</span> <span class="comment">% needed&nbsp;?</span>
   <span class="cs">\disableXMLexpansion</span>
   <span class="cs">\catcode</span>`\<span class="br">{</span><span class="brx">=</span><span class="cs">\@@begingroup</span>
   <span class="cs">\catcode</span>`\<span class="br">}</span><span class="brx">=</span><span class="cs">\@@endgroup</span>
   <span class="cs">\catcode</span>`<span class="cs">\\</span><span class="brx">=</span><span class="cs">\@@escape</span>
   <span class="cs">\iftraceXMLremapping</span>
     <span class="cs">\ifmmode</span><span class="cs">\vbox</span><span class="cs">\fi</span><span class="cs">\bgroup</span>
     <span class="cs"><span class="systemcs">\convertcommand</span></span><span class="cs">\remappedXMLdata</span><span class="cs">\to</span><span class="cs">\ascii</span>
     <span class="cs">\tttf</span><span class="cs"><span class="stylecs">\veryraggedright</span></span><span class="cs">\ascii</span><span class="cs">\par</span>
     <span class="cs"><span class="systemcs">\writestatus</span></span><span class="br">{</span>xml-remap<span class="br">}</span><span class="br">{</span><span class="cs">\ascii</span><span class="br">}</span><span class="comment">%</span>
     <span class="cs">\egroup</span>
   <span class="cs">\fi</span>
   <span class="brx">#</span>2<span class="cs">\scantokens</span><span class="cs">\@EA</span><span class="br">{</span><span class="cs">\remappedXMLdata</span><span class="cs">\empty</span><span class="cs">\empty</span><span class="br">}</span><span class="brx">#</span>3<span class="comment">%</span>
   <span class="cs">\stopXMLmapping</span>
   <span class="cs">\egroup</span><span class="br">}</span>

<span class="cs">\protect</span>

<span class="cs">\def</span><span class="cs">\MMLpTEXT</span><span class="brx">#</span>1<span class="brx">#</span>2<span class="comment">%</span>
  <span class="br">{</span><span class="cs">\hbox</span>
     <span class="br">{</span><span class="cs">\tf</span>
      <span class="cs">\getXMLarguments</span><span class="br">{</span>mstyle<span class="br">}</span><span class="br">{</span><span class="brx">#</span>1<span class="br">}</span><span class="comment">%</span>
      <span class="cs">\doMMPpbackground</span><span class="br">{</span>mstyle<span class="br">}</span>
        <span class="br">{</span><span class="cs">\doMMPpcolor</span><span class="br">{</span>mstyle<span class="br">}</span>
           <span class="br">{</span><span class="cs">\setMMLptextstyle</span><span class="br">{</span>mstyle<span class="br">}</span><span class="comment">%</span>
            <span class="cs">\ignorespaces</span><span class="brx">#</span>2<span class="cs">\unskip</span><span class="cs">\unskip</span><span class="br">}</span><span class="br">}</span><span class="br">}</span><span class="br">}</span>
</pre>
    <p>Additional space appears in front of an inline equation (tagged as an imath element). The fix (from Hans) is made in xtag-ini.tex: locate the line
</p>
    <pre> .unexpanded.def&lt;B.doXMLelementE</pre>
    <p>and add a <tt>*</tt> immediately following it, to produce
</p>
    <pre>.unexpanded.def&lt;B.doXMLelementE*</pre>
    <p>The * (comment token) prevents the spurious space.
</p>
    <h2>
     <span class="mw-headline" id="MKIV">
      MKIV
     </span>
    </h2>
    <p>Support with MKIV is not as complete as MKII and under construction. The example above for MKIV:
</p>
    <pre class="xml">\usemodule[mathml]
\starttext
test
\xmlprocessdata{}{
<span class="br">&lt;</span><span class="name">math xmlns='http://www.w3.org/1998/Math/MathML'</span><span class="br">&gt;</span>
 <span class="br">&lt;</span><span class="name">mrow</span><span class="br">&gt;</span>
  <span class="br">&lt;</span><span class="name">msup</span><span class="br">&gt;</span> <span class="br">&lt;</span><span class="name">mi</span><span class="br">&gt;</span>x<span class="br">&lt;</span><span class="name">/mi</span><span class="br">&gt;</span><span class="br">&lt;</span><span class="name">mn</span><span class="br">&gt;</span>2<span class="br">&lt;</span><span class="name">/mn</span><span class="br">&gt;</span> <span class="br">&lt;</span><span class="name">/msup</span><span class="br">&gt;</span>
  <span class="br">&lt;</span><span class="name">mo</span><span class="br">&gt;</span>+<span class="br">&lt;</span><span class="name">/mo</span><span class="br">&gt;</span>
  <span class="br">&lt;</span><span class="name">mrow</span><span class="br">&gt;</span>
    <span class="br">&lt;</span><span class="name">mn</span><span class="br">&gt;</span>4<span class="br">&lt;</span><span class="name">/mn</span><span class="br">&gt;</span><span class="br">&lt;</span><span class="name">mi</span><span class="br">&gt;</span>x<span class="br">&lt;</span><span class="name">/mi</span><span class="br">&gt;</span>
  <span class="br">&lt;</span><span class="name">/mrow</span><span class="br">&gt;</span>
  <span class="br">&lt;</span><span class="name">mo</span><span class="br">&gt;</span>+<span class="br">&lt;</span><span class="name">/mo</span><span class="br">&gt;</span>
  <span class="br">&lt;</span><span class="name">mn</span><span class="br">&gt;</span>4<span class="br">&lt;</span><span class="name">/mn</span><span class="br">&gt;</span>
 <span class="br">&lt;</span><span class="name">/mrow</span><span class="br">&gt;</span>
<span class="br">&lt;</span><span class="name">/math</span><span class="br">&gt;</span>
}{}
\stoptext
</pre>
   </div>
  </article>
  <footer>
   <ul role="list">
    <li>
     <a href="index.html">
      Home
     </a>
    </li>
    <li>
     Mirrored on 2026-01-10
    </li>
    <li>
     <a href="http://www.gnu.org/copyleft/fdl.html" rel="license">
      GFDL 1.2
     </a>
    </li>
    <li>
     <a href="https://wiki.contextgarden.net/MathML_code_examples">
      Original page
     </a>
    </li>
   </ul>
  </footer>
 </body>
</html>
