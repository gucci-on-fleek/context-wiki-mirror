<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <link href="style.css" rel="stylesheet">
  <link href="favicon.ico" rel="icon" sizes="32x32">
  <title>
   Odd, even , first page not working&mdash;ConTeXt Wiki Mirror
  </title>
  <link href="https://wiki.contextgarden.net/Odd,_even_,_first_page_not_working" rel="canonical">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="#241504" name="theme-color">
  <meta content="light dark" name="color-scheme">
 </head>
 <body>
  <header>
   <h1 id="page-title">
    Odd, even , first page not working
   </h1>
   <p>Unofficial <a href="https://wiki.contextgarden.net/">ConTeXt Wiki</a> mirror</p>
   <p>Last modified: <a href="https://wiki.contextgarden.net/index.php?curid=956&diff=12577">2012-01-28</a>
        </p>
  </header>
  <article>
   <div class="mw-parser-output">
    <p>One is able to use different page layouts for the first, even and odd pages, but when it comes to varying text widths, ConTeXt doesn't adapt the paragraph width at a page boundary:
</p>
    <pre class="tex"> <span class="comment">% setup layout for first page</span>
 <span class="cs"><span class="stylecs">\definelayout</span></span><span class="brx">[</span>1<span class="brx">]</span><span class="brx">[</span>
  leftmargin<span class="brx">=</span>25mm,
  rightmargin<span class="brx">=</span>30mm,
  cutspace<span class="brx">=</span>50mm,
  backspace<span class="brx">=</span>40mm,
  height<span class="brx">=</span>fit,
  width<span class="brx">=</span>fit,
 <span class="brx">]</span>

 <span class="cs"><span class="stylecs">\definelayout</span></span><span class="brx">[</span>even<span class="brx">]</span><span class="brx">[</span>
  leftmargin<span class="brx">=</span>30mm,
  rightmargin<span class="brx">=</span>25mm,
  cutspace<span class="brx">=</span>50mm,
  backspace<span class="brx">=</span>40mm,
  height<span class="brx">=</span>fit,
  width<span class="brx">=</span>fit,
  <span class="brx">]</span>

 <span class="cs"><span class="stylecs">\definelayout</span></span><span class="brx">[</span>odd<span class="brx">]</span><span class="brx">[</span>
  leftmargin<span class="brx">=</span>25mm,
  rightmargin<span class="brx">=</span>30mm,
  cutspace<span class="brx">=</span>50mm,
  backspace<span class="brx">=</span>40mm,
  height<span class="brx">=</span>fit,
  width<span class="brx">=</span>fit,
  <span class="brx">]</span>

<span class="cs"><span class="stylecs">\setuplayout</span></span>
</pre>
    <p>This code sets up different sizes for each page. However, the text does not flow from one page to the next. For example, if the even pages is very wide, and the odd page is narrow, then a paragraph starting on the even page and continuing on the odd page will run over.
</p>
    <p>Hans presented [<a class="external text" href="http://archive.contextgarden.net/message/20050321.003053.1d7975e1.html" rel="nofollow">a workaround</a>] on the mailing list, with the caveat that it's "for novels only", meaning, no display math or floats. Consider yourself warned if you expect this to work beyond what's specified:
</p>
    <pre class="tex"><span class="cs"><span class="stylecs">\startsetups</span></span> <span class="brx">[</span>grid<span class="brx">]</span> <span class="brx">[</span>*default<span class="brx">]</span>
  <span class="cs">\nopenalties</span>
<span class="cs"><span class="stylecs">\stopsetups</span></span>

<span class="cs"><span class="stylecs">\setuppagenumbering</span></span>
  <span class="brx">[</span>alternative<span class="brx">=</span>doublesided<span class="brx">]</span>

<span class="cs"><span class="stylecs">\setuplayout</span></span>
  <span class="brx">[</span>grid<span class="brx">=</span>yes<span class="brx">]</span>

<span class="cs"><span class="stylecs">\definelayout</span></span>
  <span class="brx">[</span>odd<span class="brx">]</span>
  <span class="brx">[</span>width<span class="brx">=</span>10cm,
   lines<span class="brx">=</span>40<span class="brx">]</span>

<span class="cs"><span class="stylecs">\definelayout</span></span>
  <span class="brx">[</span>even<span class="brx">]</span>
  <span class="brx">[</span>width<span class="brx">=</span>8cm,
   lines<span class="brx">=</span>40<span class="brx">]</span>

<span class="cs"><span class="stylecs">\setuplayout</span></span>
  <span class="brx">[</span>odd<span class="brx">]</span>

<span class="cs"><span class="stylecs">\setuptolerance</span></span>
  <span class="brx">[</span>verytolerant<span class="brx">]</span>

<span class="cs"><span class="documentcs">\showframe</span></span>

<span class="cs">\def</span><span class="cs">\SetLineWidths</span>
  <span class="br">{</span><span class="cs">\scratchtoks</span> <span class="cs">\emptytoks</span>
   <span class="cs">\ifdim</span><span class="cs">\pagegoal</span><span class="brx">=</span><span class="cs">\maxdimen</span>
     <span class="cs">\scratchdimen</span><span class="cs">\textheight</span>
     <span class="cs">\ifodd</span><span class="cs">\realpageno</span>
       <span class="cs"><span class="systemcs">\noflines</span></span><span class="cs">\namedlayoutparameter</span><span class="br">{</span>odd<span class="br">}</span><span class="br">{</span>lines<span class="br">}</span><span class="comment">%</span>
     <span class="cs">\else</span>
       <span class="cs"><span class="systemcs">\noflines</span></span><span class="cs">\namedlayoutparameter</span><span class="br">{</span>even<span class="br">}</span><span class="br">{</span>lines<span class="br">}</span><span class="comment">%</span>
     <span class="cs">\fi</span>
   <span class="cs">\else</span>
     <span class="cs">\scratchdimen</span><span class="cs">\dimexpr</span><span class="cs">\pagegoal</span>-<span class="cs">\pagetotal</span><span class="cs">\relax</span>
     <span class="cs">\advance</span><span class="cs">\scratchdimen</span>-<span class="cs">\topskipgap</span>
     <span class="cs"><span class="systemcs">\getnoflines</span></span><span class="cs">\scratchdimen</span>
   <span class="cs">\fi</span>
   <span class="cs">\ifdim</span><span class="cs">\scratchdimen</span>&lt;<span class="cs">\lineheight</span>
     <span class="cs"><span class="documentcs">\page</span></span>
   <span class="cs">\else</span>
     <span class="cs">\scratchcounter</span><span class="cs"><span class="systemcs">\noflines</span></span><span class="cs">\relax</span>
     <span class="cs">\ifodd</span><span class="cs">\realpageno</span>
       <span class="cs">\doSetLineWidths</span><span class="br">{</span>odd<span class="br">}</span><span class="br">{</span>even<span class="br">}</span><span class="comment">%</span>
     <span class="cs">\else</span>
       <span class="cs">\doSetLineWidths</span><span class="br">{</span>even<span class="br">}</span><span class="br">{</span>odd<span class="br">}</span><span class="comment">%</span>
     <span class="cs">\fi</span>
     <span class="cs">\parshape</span> <span class="cs">\scratchcounter</span> <span class="cs">\the</span><span class="cs">\scratchtoks</span> <span class="cs">\relax</span> <span class="cs">\ignorespaces</span>
   <span class="cs">\fi</span><span class="br">}</span>

<span class="cs">\def</span><span class="cs">\doSetLineWidths</span><span class="brx">#</span>1<span class="brx">#</span>2<span class="comment">%</span>
  <span class="br">{</span><span class="cs"><span class="systemcs">\dorecurse</span></span><span class="cs"><span class="systemcs">\noflines</span></span>
     <span class="br">{</span><span class="cs"><span class="systemcs">\appendetoks</span></span> 0cm <span class="cs">\namedlayoutparameter</span><span class="br">{</span><span class="brx">#</span>1<span class="br">}</span><span class="br">{</span>width<span class="br">}</span> <span class="cs">\to</span><span class="cs">\scratchtoks</span><span class="br">}</span><span class="comment">%</span>
   <span class="cs"><span class="systemcs">\dorecurse</span></span><span class="br">{</span>2<span class="br">}</span>
     <span class="br">{</span><span class="cs">\advance</span><span class="cs">\scratchcounter</span><span class="cs">\namedlayoutparameter</span><span class="br">{</span><span class="brx">#</span>2<span class="br">}</span><span class="br">{</span>lines<span class="br">}</span><span class="cs">\relax</span>
      <span class="cs"><span class="systemcs">\dorecurse</span></span><span class="br">{</span><span class="cs">\namedlayoutparameter</span><span class="br">{</span><span class="brx">#</span>2<span class="br">}</span><span class="br">{</span>lines<span class="br">}</span><span class="br">}</span>
        <span class="br">{</span><span class="cs"><span class="systemcs">\appendetoks</span></span> 0cm <span class="cs">\namedlayoutparameter</span><span class="br">{</span><span class="brx">#</span>2<span class="br">}</span><span class="br">{</span>width<span class="br">}</span> <span class="cs">\to</span><span class="cs">\scratchtoks</span><span class="br">}</span><span class="comment">%</span>
      <span class="cs">\advance</span><span class="cs">\scratchcounter</span><span class="cs">\namedlayoutparameter</span><span class="br">{</span><span class="brx">#</span>1<span class="br">}</span><span class="br">{</span>lines<span class="br">}</span><span class="cs">\relax</span>
      <span class="cs"><span class="systemcs">\dorecurse</span></span><span class="br">{</span><span class="cs">\namedlayoutparameter</span><span class="br">{</span><span class="brx">#</span>1<span class="br">}</span><span class="br">{</span>lines<span class="br">}</span><span class="br">}</span>
        <span class="br">{</span><span class="cs"><span class="systemcs">\appendetoks</span></span> 0cm <span class="cs">\namedlayoutparameter</span><span class="br">{</span><span class="brx">#</span>1<span class="br">}</span><span class="br">{</span>width<span class="br">}</span> <span class="cs">\to</span><span class="cs">\scratchtoks</span><span class="br">}</span><span class="br">}</span><span class="br">}</span>

<span class="cs">\dontcomplain</span>

<span class="cs"><span class="systemcs">\EveryPar</span></span><span class="br">{</span><span class="cs">\SetLineWidths</span><span class="br">}</span>

<span class="cs"><span class="documentcs">\starttext</span></span>

<span class="cs"><span class="systemcs">\dorecurse</span></span><span class="br">{</span>25<span class="br">}</span><span class="br">{</span><span class="cs"><span class="systemcs">\dorecurse</span></span><span class="br">{</span>4<span class="br">}</span><span class="br">{</span><span class="cs"><span class="documentcs">\input</span></span> tufte <span class="br">}</span><span class="cs">\par</span><span class="br">}</span>

<span class="cs"><span class="documentcs">\stoptext</span></span>
 </pre>
   </div>
  </article>
  <footer>
   <ul role="list">
    <li>
     <a href="index.html">
      Home
     </a>
    </li>
    <li>
     Mirrored on 2026-01-16
    </li>
    <li>
     <a href="http://www.gnu.org/copyleft/fdl.html" rel="license">
      GFDL 1.2
     </a>
    </li>
    <li>
     <a href="https://wiki.contextgarden.net/Odd,_even_,_first_page_not_working">
      Original page
     </a>
    </li>
   </ul>
  </footer>
 </body>
</html>
