<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <link href="../../style.css" rel="stylesheet">
  <link href="../../favicon.ico" rel="icon" sizes="32x32">
  <title>
   Graphics and media/Drawing graphs and diagrams/MetaObj and Labels&mdash;ConTeXt Wiki Mirror
  </title>
  <link href="https://wiki.contextgarden.net/Graphics_and_media/Drawing_graphs_and_diagrams/MetaObj_and_Labels" rel="canonical">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="#241504" name="theme-color">
  <meta content="light dark" name="color-scheme">
 </head>
 <body>
  <header>
   <h1 id="page-title">
    Graphics and media/Drawing graphs and diagrams/MetaObj and Labels
   </h1>
   <p>Unofficial <a href="https://wiki.contextgarden.net/">ConTeXt Wiki</a> mirror</p>
   <p>Last modified: <a href="https://wiki.contextgarden.net/index.php?curid=3404&diff=41608">2025-01-18</a>
        </p>
  </header>
  <article>
   <div class="mw-parser-output">
    <p><a class="external text" href="http://www.ctan.org/tex-archive/graphics/metapost/contrib/macros/metaobj/" rel="nofollow">MetaObj</a> is a system for high-level object-oriented drawing based on <a href="../Tutorials/Graphical_programming_with_MetaPost_and_MetaFun.html" title="Graphics and media/Tutorials/Graphical programming with MetaPost and MetaFun">MetaPost and MetaFun</a> (from the <a class="external text" href="http://mirror.ctan.org/graphics/metapost/contrib/macros/metaobj/doc/momanual.pdf" rel="nofollow">manual</a>).
</p>
    <p>When using text labels in embedded MetaPost code within ConTeXt, the whole MetaPost code is processed in two runs. This causes problems with MetaObj, because it doesn't expect this. See <a class="external text" href="http://archive.contextgarden.net/thread/20110118.121745.612f819e.en.html#20110118.121745.612f819e" rel="nofollow">this mailing list thread</a> for details. The following example (from the manual, modified by Aditya Mahajan) shows how to avoid those problems.
</p>
    <pre class="tex"><span class="cs"><span class="stylecs">\startMPinclusions</span></span><span class="brx">[</span>+<span class="brx">]</span>
  input metaobj;
  boolean flag; flag&nbsp;:<span class="brx">=</span> false; <span class="comment">% flag is false in the first run</span>
<span class="cs"><span class="stylecs">\stopMPinclusions</span></span>

<span class="cs"><span class="stylecs">\startMPdefinitions</span></span>
  vardef newSegment@<span class="brx">#</span> <span class="brx">=</span>
    if not flag:
      assignObj<span class="brx">(</span>@<span class="brx">#</span>, "Segment"<span class="brx">)</span>; <span class="comment">% this should be called only once</span>
      ObjPoint a, b;
      ObjCode "@<span class="brx">#</span>b - @<span class="brx">#</span>a <span class="brx">=</span> <span class="brx">(</span>1cm, 2cm<span class="brx">)</span>";
    fi;
  enddef;

  def drawSegment<span class="brx">(</span>suffix n<span class="brx">)</span> <span class="brx">=</span>
    draw n.a -- n.b;
    draw btex E etex shifted n.a;
  enddef;
<span class="cs"><span class="stylecs">\stopMPdefinitions</span></span>

<span class="cs"><span class="documentcs">\starttext</span></span>
<span class="cs"><span class="documentcs">\startMPpage</span></span>
  newSegment.s;
  s.a <span class="brx">=</span> origin;
  drawObj<span class="brx">(</span>s<span class="brx">)</span>;

  newSegment.t;
  if not flag:
    rotateObj<span class="brx">(</span>t, 180<span class="brx">)</span>; <span class="comment">% we don't want the object rotated twice</span>
  fi;
  t.a <span class="brx">=</span> s.a + <span class="brx">(</span>4cm, 1cm<span class="brx">)</span>;
  drawObj<span class="brx">(</span>t<span class="brx">)</span>;

  flag&nbsp;:<span class="brx">=</span> true; <span class="comment">% flag will be true after the first run</span>
<span class="cs"><span class="documentcs">\stopMPpage</span></span>
<span class="cs"><span class="documentcs">\stoptext</span></span>
</pre>
    <p>Just use "if not flag" constructions around anything that might cause trouble. Sometimes even the definition of relations (bindings) between objects will require precautions.
</p>
   </div>
  </article>
  <footer>
   <ul role="list">
    <li>
     <a href="../../index.html">
      Home
     </a>
    </li>
    <li>
     Mirrored on 2026-01-12
    </li>
    <li>
     <a href="http://www.gnu.org/copyleft/fdl.html" rel="license">
      GFDL 1.2
     </a>
    </li>
    <li>
     <a href="https://wiki.contextgarden.net/Graphics_and_media/Drawing_graphs_and_diagrams/MetaObj_and_Labels">
      Original page
     </a>
    </li>
   </ul>
  </footer>
 </body>
</html>
