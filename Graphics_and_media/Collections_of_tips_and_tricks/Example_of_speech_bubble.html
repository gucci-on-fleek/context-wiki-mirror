<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <link href="../../style.css" rel="stylesheet">
  <link href="../../favicon.ico" rel="icon" sizes="32x32">
  <title>
   Graphics and media/Collections of tips and tricks/Example of speech bubble&mdash;ConTeXt Wiki Mirror
  </title>
  <link href="https://wiki.contextgarden.net/Graphics_and_media/Collections_of_tips_and_tricks/Example_of_speech_bubble" rel="canonical">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="#241504" name="theme-color">
  <meta content="light dark" name="color-scheme">
 </head>
 <body>
  <header>
   <h1 id="page-title">
    Graphics and media/Collections of tips and tricks/Example of speech bubble
   </h1>
   <p>Unofficial <a href="https://wiki.contextgarden.net/">ConTeXt Wiki</a> mirror</p>
   <p>Last modified: <a href="https://wiki.contextgarden.net/index.php?curid=3429&diff=41364">2025-01-18</a>
        </p>
  </header>
  <article>
   <div class="mw-parser-output">
    <p>This page describes a few ways to create speech bubbles.
</p>
    <h2>
     <span class="mw-headline" id="LMTX">
      LMTX
     </span>
    </h2>
    <p>Using ConTeXt LMTX, the following code generates a dependency-free speech bubble:
</p>
    <ul class="demo">
     <li class="code">
      <pre class="tex"><span class="cs"><span class="stylecs">\startuseMPgraphic</span></span><span class="br">{</span>TextBubble<span class="br">}</span><span class="br">{</span>side<span class="br">}</span>
  z1 <span class="brx">=</span> <span class="brx">(</span>0, 0<span class="brx">)</span>&nbsp;;
  z2 <span class="brx">=</span> <span class="brx">(</span>OverlayWidth, 0<span class="brx">)</span>&nbsp;;
  z3 <span class="brx">=</span> <span class="brx">(</span>OverlayWidth, OverlayHeight<span class="brx">)</span>&nbsp;;
  z4 <span class="brx">=</span> <span class="brx">(</span>0, OverlayHeight<span class="brx">)</span>&nbsp;;

  offset&nbsp;:<span class="brx">=</span> 1&nbsp;;
  tail&nbsp;:<span class="brx">=</span> 1&nbsp;;

  if <span class="cs"><span class="stylecs">\MPvar</span></span><span class="br">{</span>side<span class="br">}</span> <span class="brx">=</span> 1:
    offset&nbsp;:<span class="brx">=</span> 5&nbsp;;
    tail&nbsp;:<span class="brx">=</span> -1&nbsp;;
  fi

  <span class="brx">(</span>offset/6<span class="brx">)</span><span class="brx">[</span>x1,x2<span class="brx">]</span> <span class="brx">=</span> x8 + 1cm * tail <span class="brx">=</span> x7 + .5cm <span class="brx">=</span> x9 - .5cm&nbsp;;
  y7 <span class="brx">=</span>  0cm&nbsp;;
  y8 <span class="brx">=</span> -1cm&nbsp;;
  y9 <span class="brx">=</span>  0cm&nbsp;;

  path p&nbsp;;
  p <span class="brx">=</span> <span class="brx">(</span>z1--z7--z8--z9--z2--z3--z4--cycle<span class="brx">)</span> cornered .25cm&nbsp;;
  draw p withpen pencircle scaled 0.5&nbsp;;

  setbounds currentpicture to OverlayBox&nbsp;;
<span class="cs"><span class="stylecs">\stopuseMPgraphic</span></span>

<span class="comment">% Receive text (left-facing).</span>
<span class="cs"><span class="stylecs">\defineoverlay</span></span><span class="brx">[</span>TextBubbleRxOverlay<span class="brx">]</span><span class="brx">[</span><span class="cs"><span class="stylecs">\useMPgraphic</span></span><span class="br">{</span>TextBubble<span class="br">}</span><span class="br">{</span>side<span class="brx">=</span>0<span class="br">}</span><span class="brx">]</span>
<span class="cs"><span class="stylecs">\defineframedtext</span></span><span class="brx">[</span>TextBubbleRxFrame<span class="brx">]</span><span class="brx">[</span>
  frame<span class="brx">=</span>off,
  background<span class="brx">=</span>TextBubbleRxOverlay,
  width<span class="brx">=</span>fit,
  offset<span class="brx">=</span>.75em,
  location<span class="brx">=</span>left,
  after<span class="brx">=</span><span class="br">{</span><span class="cs"><span class="documentcs">\blank</span></span><span class="brx">[</span>1.25cm<span class="brx">]</span><span class="br">}</span>,
<span class="brx">]</span>

<span class="comment">% Send text (right-facing).</span>
<span class="cs"><span class="stylecs">\defineoverlay</span></span><span class="brx">[</span>TextBubbleTxOverlay<span class="brx">]</span><span class="brx">[</span><span class="cs"><span class="stylecs">\useMPgraphic</span></span><span class="br">{</span>TextBubble<span class="br">}</span><span class="br">{</span>side<span class="brx">=</span>1<span class="br">}</span><span class="brx">]</span>
<span class="cs"><span class="stylecs">\defineframedtext</span></span><span class="brx">[</span>TextBubbleTxFrame<span class="brx">]</span><span class="brx">[</span>
  frame<span class="brx">=</span>off,
  background<span class="brx">=</span>TextBubbleTxOverlay,
  width<span class="brx">=</span>fit,
  offset<span class="brx">=</span>.75em,
  location<span class="brx">=</span>right,
  after<span class="brx">=</span><span class="br">{</span><span class="cs"><span class="documentcs">\blank</span></span><span class="brx">[</span>1.25cm<span class="brx">]</span><span class="br">}</span>,
<span class="brx">]</span>

<span class="cs"><span class="documentcs">\starttext</span></span> 
  <span class="cs">\startTextBubbleRxFrame</span>
    <span class="cs"><span class="documentcs">\input</span></span> weisman
  <span class="cs">\stopTextBubbleRxFrame</span>

  <span class="cs">\startTextBubbleTxFrame</span>
    <span class="cs"><span class="documentcs">\input</span></span> ward
  <span class="cs">\stopTextBubbleTxFrame</span>

  <span class="cs"><span class="documentcs">\input</span></span> knuth
<span class="cs"><span class="documentcs">\stoptext</span></span>
</pre>
     </li>
     <li class="rendering">
      <img height="1240" src="../../wikiteximage/426ebb858604f6adee4dc94483f10b42.webp" width="874">
     </li>
    </ul>
    <h2>
     <span class="mw-headline" id="Tikz_Module">
      Tikz Module
     </span>
    </h2>
    <p>Use the Tikz module to create &laquo;&nbsp;speech bubbles&nbsp;&raquo;. Here are two ways of doing this: the first one works under mkii and mkiv, while the second one needs the Annotation module written by Wofgang Schuster who wrapped  the Tikz commands in ConTeXt macros in the code below.
</p>
    <pre class="tex">

<span class="cs"><span class="stylecs">\usemodule</span></span><span class="brx">[</span>tikz<span class="brx">]</span>
<span class="cs">\usetikzlibrary</span><span class="brx">[</span>shapes.callouts<span class="brx">]</span>

<span class="cs"><span class="stylecs">\setupbodyfont</span></span><span class="brx">[</span>bookman<span class="brx">]</span>

<span class="cs"><span class="stylecs">\setupTEXpage</span></span><span class="brx">[</span>offset<span class="brx">=</span>1em<span class="brx">]</span>

<span class="cs"><span class="documentcs">\starttext</span></span>

<span class="cs"><span class="documentcs">\startTEXpage</span></span>
<span class="cs">\starttikzpicture</span><span class="brx">[</span>remember picture<span class="brx">]</span>
  <span class="cs">\node</span><span class="brx">[</span>ellipse callout, draw<span class="brx">]</span> <span class="brx">(</span>node:ref<span class="brx">)</span> <span class="br">{</span>Hi there!<span class="br">}</span>;
<span class="cs">\stoptikzpicture</span>
<span class="cs"><span class="documentcs">\stopTEXpage</span></span>

<span class="cs"><span class="documentcs">\startTEXpage</span></span>
<span class="cs">\starttikzpicture</span><span class="brx">[</span>remember picture<span class="brx">]</span>
  <span class="cs">\node</span><span class="brx">[</span>cloud callout, draw<span class="brx">]</span> <span class="brx">(</span>node:ref<span class="brx">)</span> <span class="br">{</span>Hallo!<span class="br">}</span>;
<span class="cs">\stoptikzpicture</span>
<span class="cs"><span class="documentcs">\stopTEXpage</span></span>

<span class="cs"><span class="documentcs">\startTEXpage</span></span>
<span class="cs">\starttikzpicture</span>
  <span class="cs">\node</span><span class="brx">[</span>cloud callout, cloud puffs<span class="brx">=</span>15, aspect<span class="brx">=</span>2.5, cloud puff arc<span class="brx">=</span>120,
    shading<span class="brx">=</span>ball,text<span class="brx">=</span>white<span class="brx">]</span> <span class="br">{</span><span class="cs">\bf</span> Imagine<span class="cs">\dots</span><span class="br">}</span>;
<span class="cs">\stoptikzpicture</span>
<span class="cs"><span class="documentcs">\stopTEXpage</span></span>

<span class="cs"><span class="documentcs">\startTEXpage</span></span>
<span class="cs">\starttikzpicture</span><span class="brx">[</span>remember picture, note/.style<span class="brx">=</span><span class="br">{</span>rectangle callout, fill<span class="brx">=</span><span class="brx">#</span>1<span class="br">}</span><span class="brx">]</span>
  <span class="cs">\draw</span> <span class="brx">[</span>help lines<span class="brx">]</span> grid<span class="brx">(</span>3,2<span class="brx">)</span>;
  <span class="cs">\node</span> <span class="brx">[</span>note<span class="brx">=</span>red!50, callout relative pointer<span class="brx">=</span><span class="br">{</span><span class="brx">(</span>0,1<span class="brx">)</span><span class="br">}</span><span class="brx">]</span> at <span class="brx">(</span>3,1<span class="brx">)</span> <span class="br">{</span>Relative position<span class="br">}</span>;
  <span class="cs">\node</span> <span class="brx">[</span>note<span class="brx">=</span>blue!50, callout absolute pointer<span class="brx">=</span><span class="br">{</span><span class="brx">(</span>0,1<span class="brx">)</span><span class="br">}</span><span class="brx">]</span> at <span class="brx">(</span>1,0<span class="brx">)</span> <span class="br">{</span>Absolute position<span class="br">}</span>;
  <span class="cs">\node</span> <span class="brx">[</span>note<span class="brx">=</span>green!50, ellipse callout, opacity<span class="brx">=</span>.5, overlay, callout absolute pointer<span class="brx">=</span><span class="br">{</span><span class="brx">(</span>hallo.south<span class="brx">)</span><span class="br">}</span><span class="brx">]</span> at <span class="brx">(</span>1,2<span class="brx">)</span> <span class="br">{</span>Outside<span class="br">}</span>;
<span class="cs">\stoptikzpicture</span>
<span class="cs"><span class="documentcs">\stopTEXpage</span></span>

<span class="cs"><span class="documentcs">\stoptext</span></span>
</pre>
    <p>In the above example, you can leave out the \startTEXpage and \stopTEXpage, and use the pictures and you wish in your text.
</p>
    <p>The second example is as follows:
</p>
    <pre class="tex">

<span class="cs"><span class="stylecs">\usemodule</span></span><span class="brx">[</span>tikz,annotation<span class="brx">]</span>
<span class="cs">\usetikzlibrary</span><span class="brx">[</span>shapes.callouts<span class="brx">]</span>

<span class="cs"><span class="systemcs">\define</span></span><span class="brx">[</span>2<span class="brx">]</span><span class="cs">\SpeechbubbleCommand</span>
 <span class="br">{</span><span class="cs">\starttikzpicture</span><span class="brx">[</span>remember picture<span class="brx">]</span>
  <span class="cs">\node</span><span class="brx">[</span>rectangle callout, draw<span class="brx">]</span> <span class="brx">(</span>node:ref<span class="brx">)</span> <span class="br">{</span><span class="cs"><span class="documentcs">\framedtext</span></span><span class="brx">[</span>width<span class="brx">=</span>fit,frame<span class="brx">=</span>off<span class="brx">]</span><span class="br">{</span><span class="brx">#</span>2<span class="br">}</span><span class="br">}</span>;
  <span class="cs">\stoptikzpicture</span><span class="br">}</span>

<span class="cs">\defineannotation</span>
 <span class="brx">[</span>speechbubble<span class="brx">]</span>
 <span class="brx">[</span>alternative<span class="brx">=</span>command,
      command<span class="brx">=</span><span class="cs">\SpeechbubbleCommand</span><span class="brx">]</span>

<span class="cs"><span class="documentcs">\starttext</span></span>

<span class="cs">\speechbubble</span><span class="br">{</span>Hello!<span class="br">}</span>

<span class="cs">\startspeechbubble</span>
<span class="cs"><span class="documentcs">\input</span></span> ward
<span class="cs">\stopspeechbubble</span>

<span class="cs"><span class="documentcs">\stoptext</span></span>
</pre>
    <p>As said before the above code needs mkiv functionalities (due to the usage of the Annotation module). Indeed you can change some of Tikz commands in the above defintions, for instance change the command
</p>
    <pre class="tex"><span class="cs">\node</span><span class="brx">[</span>rectangle callout, draw<span class="brx">]</span>
</pre>
    <p>into
</p>
    <pre class="tex"><span class="cs">\node</span><span class="brx">[</span>cloud callout, draw<span class="brx">]</span>
</pre>
    <p>to get other bubble shapes.
</p>
    <!-- 
NewPP limit report
Cached time: 20260109212416
Cache expiry: 86400
Dynamic content: false
Complications: []
CPU time usage: 0.037 seconds
Real time usage: 0.071 seconds
Preprocessor visited node count: 25/1000000
Preprocessor generated node count: 0/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 10734/5000000 bytes
-->
    <!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->
    <!-- Saved in parser cache with key wikidb16_33:pcache:idhash:3429-1!canonical and timestamp 20260109212416 and revision id 41364
 -->
   </div>
  </article>
  <footer>
   <ul role="list">
    <li>
     <a href="../../index.html">
      Home
     </a>
    </li>
    <li>
     Mirrored on 2026-01-10
    </li>
    <li>
     <a href="http://www.gnu.org/copyleft/fdl.html" rel="license">
      GFDL 1.2
     </a>
    </li>
    <li>
     <a href="https://wiki.contextgarden.net/Graphics_and_media/Collections_of_tips_and_tricks/Example_of_speech_bubble">
      Original page
     </a>
    </li>
   </ul>
  </footer>
 </body>
</html>
