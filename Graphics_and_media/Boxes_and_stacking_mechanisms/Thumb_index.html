<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <link href="../../style.css" rel="stylesheet">
  <link href="../../favicon.ico" rel="icon" sizes="32x32">
  <title>
   Graphics and media/Boxes and stacking mechanisms/Thumb index&mdash;ConTeXt Wiki Mirror
  </title>
  <link href="https://wiki.contextgarden.net/Graphics_and_media/Boxes_and_stacking_mechanisms/Thumb_index" rel="canonical">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="#241504" name="theme-color">
  <meta content="light dark" name="color-scheme">
 </head>
 <body>
  <header>
   <h1 id="page-title">
    Graphics and media/Boxes and stacking mechanisms/Thumb index
   </h1>
   <p>Unofficial <a href="https://wiki.contextgarden.net/">ConTeXt Wiki</a> mirror</p>
   <p>Last modified: <a href="https://wiki.contextgarden.net/index.php?curid=938&diff=41625">2025-01-18</a>
        </p>
  </header>
  <article>
   <div class="mw-parser-output">
    <p>The following code is an example of how to draw a graphic on every page of a document. The graphic (a grey rectangle) appears in a different place for each chapter, and the chapter number appears in the rectangle as well. This is often called a thumb index - your thumb can flip the pages of a book while you watch the contents flash past...
</p>
    <ul class="demo">
     <li class="code">
      <pre class="tex"><span class="comment">% these first lines are just for wiki layout and visualisation</span>
<span class="cs"><span class="stylecs">\setuppapersize</span></span><span class="brx">[</span>A8<span class="brx">]</span><span class="brx">[</span>A5,landscape<span class="brx">]</span> <span class="cs"><span class="documentcs">\showframe</span></span>
<span class="cs"><span class="stylecs">\setuppaper</span></span><span class="brx">[</span>nx<span class="brx">=</span>4,ny<span class="brx">=</span>2<span class="brx">]</span>
<span class="cs"><span class="stylecs">\setuparranging</span></span><span class="brx">[</span>XY<span class="brx">]</span>
<span class="cs"><span class="stylecs">\usemodule</span></span><span class="brx">[</span>visual<span class="brx">]</span>

<span class="cs">\def</span><span class="cs">\currentchapternumber</span>
   <span class="br">{</span><span class="cs"><span class="systemcs">\somenamedheadnumber</span></span><span class="br">{</span>chapter<span class="br">}</span><span class="br">{</span>current<span class="br">}</span><span class="br">}</span>

<span class="cs">\def</span><span class="cs">\lastchapternumber</span>
   <span class="br">{</span><span class="cs"><span class="systemcs">\somenamedheadnumber</span></span><span class="br">{</span>chapter<span class="br">}</span><span class="br">{</span>last<span class="br">}</span><span class="br">}</span>

<span class="cs"><span class="stylecs">\setuppagenumbering</span></span>
   <span class="brx">[</span>alternative<span class="brx">=</span>doublesided<span class="brx">]</span>

<span class="cs"><span class="stylecs">\setupbackgrounds</span></span>
   <span class="brx">[</span>page<span class="brx">]</span>
   <span class="brx">[</span>background<span class="brx">=</span>thumbs<span class="brx">]</span>

<span class="cs"><span class="stylecs">\defineoverlay</span></span>
   <span class="brx">[</span>thumbs<span class="brx">]</span>
   <span class="brx">[</span><span class="cs"><span class="stylecs">\setups</span></span><span class="br">{</span>thumbs<span class="br">}</span><span class="brx">]</span>

<span class="cs">\newdimen</span><span class="cs">\thumbheight</span>

<span class="cs"><span class="stylecs">\startsetups</span></span> thumbs
     <span class="cs">\ifnum</span> <span class="cs">\lastchapternumber</span> &gt; 0
        <span class="cs">\thumbheight</span><span class="brx">=</span><span class="cs">\dimexpr</span><span class="cs">\paperheight</span>/<span class="cs">\lastchapternumber</span><span class="cs">\relax</span>
     <span class="cs">\fi</span>
     <span class="cs">\vbox</span> to <span class="cs">\paperheight</span> <span class="cs">\bgroup</span>
         <span class="cs">\vskip</span> <span class="cs">\currentchapternumber</span> <span class="cs">\thumbheight</span>
         <span class="cs">\vskip</span> -1                    <span class="cs">\thumbheight</span>
         <span class="cs"><span class="systemcs">\doifoddpageelse</span></span><span class="cs">\hfill</span><span class="cs"><span class="systemcs">\donothing</span></span>
         <span class="cs"><span class="documentcs">\framed</span></span>
             <span class="brx">[</span>background<span class="brx">=</span>color,
              backgroundcolor<span class="brx">=</span>blue,
              frame<span class="brx">=</span>off,
              foregroundcolor<span class="brx">=</span>white,
              height<span class="brx">=</span><span class="cs">\thumbheight</span>,
              width<span class="brx">=</span>5mm<span class="brx">]</span>
             <span class="br">{</span><span class="cs">\bfa</span> <span class="cs">\currentchapternumber</span><span class="br">}</span>
         <span class="cs"><span class="systemcs">\doifoddpageelse</span></span><span class="cs"><span class="systemcs">\donothing</span></span><span class="cs">\hfill</span>
         <span class="cs">\vss</span>
     <span class="cs">\egroup</span>

<span class="cs"><span class="stylecs">\stopsetups</span></span>

<span class="cs"><span class="documentcs">\starttext</span></span>

<span class="cs"><span class="systemcs">\dorecurse</span></span><span class="br">{</span>4<span class="br">}</span>
 <span class="br">{</span><span class="cs"><span class="documentcs">\chapter</span></span><span class="br">{</span><span class="cs">\fakewords</span><span class="br">{</span>1<span class="br">}</span><span class="br">{</span>5<span class="br">}</span><span class="br">}</span>
  <span class="cs">\fakewords</span><span class="br">{</span>50<span class="br">}</span><span class="br">{</span>100<span class="br">}</span><span class="br">}</span>

<span class="cs"><span class="documentcs">\stoptext</span></span>
</pre>
     </li>
     <li class="rendering">
      <img height="874" src="../../wikiteximage/b079635df96c3220a1cee5521378ac55.webp" width="1240">
     </li>
    </ul>
    <h2>
     <span class="mw-headline" id="Another_Example">
      Another Example
     </span>
    </h2>
    <p>An example (MkIV) for using Metapost to create thumb indices for chapters.
</p>
    <ul class="demo">
     <li class="code">
      <pre class="tex"><span class="comment">% these first lines are just for wiki layout and visualisation</span>
<span class="cs"><span class="stylecs">\setuppapersize</span></span><span class="brx">[</span>A8<span class="brx">]</span><span class="brx">[</span>A4<span class="brx">]</span> <span class="cs"><span class="documentcs">\showframe</span></span>
<span class="cs"><span class="stylecs">\setuppaper</span></span><span class="brx">[</span>nx<span class="brx">=</span>4,ny<span class="brx">=</span>4<span class="brx">]</span>
<span class="cs"><span class="stylecs">\setuparranging</span></span><span class="brx">[</span>XY<span class="brx">]</span>
<span class="cs"><span class="stylecs">\usemodule</span></span><span class="brx">[</span>visual<span class="brx">]</span>

<span class="cs"><span class="stylecs">\setuplayout</span></span>
  <span class="brx">[</span>width<span class="brx">=</span>middle,
   <span class="comment">% margin=\dimexpr\backspace-\margindistance\relax</span>
   location<span class="brx">=</span>middle<span class="brx">]</span>

<span class="cs"><span class="stylecs">\definecolor</span></span><span class="brx">[</span>chap_frame<span class="brx">]</span><span class="brx">[</span>g<span class="brx">=</span>1,t<span class="brx">=</span>1,a<span class="brx">=</span>12<span class="brx">]</span>
<span class="cs"><span class="stylecs">\definecolor</span></span><span class="brx">[</span>sect_frame<span class="brx">]</span><span class="brx">[</span>b<span class="brx">=</span>1,t<span class="brx">=</span>1,a<span class="brx">=</span>12<span class="brx">]</span>
<span class="cs"><span class="stylecs">\definecolor</span></span><span class="brx">[</span>textcolor<span class="brx">]</span> <span class="brx">[</span>r<span class="brx">=</span>1,t<span class="brx">=</span>1,a<span class="brx">=</span>12<span class="brx">]</span>

<span class="cs"><span class="stylecs">\startuseMPgraphic</span></span><span class="br">{</span>chapter thumb<span class="br">}</span>
  path chap_frame, sect_frame&nbsp;;  pair pos,a,b&nbsp;;  picture text&nbsp;;

  if  <span class="cs"><span class="systemcs">\somenamedheadnumber</span></span><span class="br">{</span>chapter<span class="br">}</span><span class="br">{</span>current<span class="br">}</span> &gt; 0&nbsp;:
     curr_chap&nbsp;:<span class="brx">=</span> <span class="cs"><span class="systemcs">\somenamedheadnumber</span></span><span class="br">{</span>chapter<span class="br">}</span><span class="br">{</span>current<span class="br">}</span>&nbsp;; 
  else&nbsp;:
     curr_chap&nbsp;:<span class="brx">=</span> 1&nbsp;;
  fi;
  if <span class="cs"><span class="systemcs">\somenamedheadnumber</span></span><span class="br">{</span>chapter<span class="br">}</span><span class="br">{</span>last<span class="br">}</span> &gt; 0&nbsp;:
     last_chap&nbsp;:<span class="brx">=</span> <span class="cs"><span class="systemcs">\somenamedheadnumber</span></span><span class="br">{</span>chapter<span class="br">}</span><span class="br">{</span>last<span class="br">}</span>&nbsp;;
  else&nbsp;:
     last_chap&nbsp;:<span class="brx">=</span> 1&nbsp;;
  fi;
  if <span class="cs"><span class="systemcs">\somenamedheadnumber</span></span><span class="br">{</span>section<span class="br">}</span><span class="br">{</span>current<span class="br">}</span> &gt; 0&nbsp;: 
     curr_sect&nbsp;:<span class="brx">=</span> <span class="cs"><span class="systemcs">\somenamedheadnumber</span></span><span class="br">{</span>section<span class="br">}</span><span class="br">{</span>current<span class="br">}</span>&nbsp;; 
  else: 
     curr_sect&nbsp;:<span class="brx">=</span> 1&nbsp;;
  fi;
  if <span class="cs"><span class="systemcs">\somenamedheadnumber</span></span><span class="br">{</span>section<span class="br">}</span><span class="br">{</span>last<span class="br">}</span> &gt; 0&nbsp;:
     last_sect&nbsp;:<span class="brx">=</span> <span class="cs"><span class="systemcs">\somenamedheadnumber</span></span><span class="br">{</span>section<span class="br">}</span><span class="br">{</span>last<span class="br">}</span>;
  else:
     last_sect&nbsp;:<span class="brx">=</span> 1;
  fi;  

  skip   :<span class="brx">=</span> TextHeight * <span class="brx">(</span>curr_chap-1<span class="brx">)</span>/last_chap&nbsp;;
  height&nbsp;:<span class="brx">=</span> TextHeight/last_chap&nbsp;;
  sskip  :<span class="brx">=</span> height*curr_sect/last_sect&nbsp;;
 
  text   :<span class="brx">=</span> textext<span class="brx">(</span>"<span class="cs">\ssbfb</span><span class="cs">\textcolor</span> Chapter<span class="cs"><span class="stylecs">\enspace</span></span><span class="cs"><span class="stylecs">\getmarking</span></span><span class="brx">[</span>chapternumber<span class="brx">]</span>"<span class="brx">)</span>;

  StartPage&nbsp;;
    chap_frame&nbsp;:<span class="brx">=</span> fullsquare xyscaled<span class="brx">(</span>RightMarginWidth,height<span class="brx">)</span>&nbsp;;

    a&nbsp;:<span class="brx">=</span> ulcorner chap_frame&nbsp;;
    b&nbsp;:<span class="brx">=</span> urcorner chap_frame&nbsp;;

    sect_frame&nbsp;:<span class="brx">=</span> a--b--<span class="brx">(</span>xpart b,ypart b-sskip<span class="brx">)</span>--<span class="brx">(</span>xpart a,ypart a-sskip<span class="brx">)</span>--cycle;

    pos&nbsp;:<span class="brx">=</span> urcorner Field<span class="brx">[</span>Text<span class="brx">]</span><span class="brx">[</span>RightMarginSeparator<span class="brx">]</span> -
           ulcorner chap_frame - <span class="brx">(</span>0,skip<span class="brx">)</span>;

    fill chap_frame shifted pos withcolor <span class="cs"><span class="stylecs">\MPcolor</span></span><span class="br">{</span>chap_frame<span class="br">}</span>;
    unfill sect_frame shifted pos withcolor white&nbsp;;
    fill sect_frame shifted pos withcolor <span class="cs"><span class="stylecs">\MPcolor</span></span><span class="br">{</span>sect_frame<span class="br">}</span>;
    draw text rotated 90 shifted pos&nbsp;;
  StopPage&nbsp;;
<span class="cs"><span class="stylecs">\stopuseMPgraphic</span></span>


<span class="cs"><span class="stylecs">\defineoverlay</span></span><span class="brx">[</span>chapter thumb<span class="brx">]</span><span class="brx">[</span><span class="cs"><span class="stylecs">\useMPgraphic</span></span><span class="br">{</span>chapter thumb<span class="br">}</span><span class="brx">]</span>

<span class="cs"><span class="stylecs">\setupbackgrounds</span></span><span class="brx">[</span>page<span class="brx">]</span><span class="brx">[</span>background<span class="brx">=</span>chapter thumb<span class="brx">]</span>


<span class="cs"><span class="documentcs">\starttext</span></span>  <span class="cs"><span class="documentcs">\showframe</span></span>
<span class="cs"><span class="systemcs">\dorecurse</span></span><span class="br">{</span>3<span class="br">}</span><span class="br">{</span><span class="cs"><span class="documentcs">\chapter</span></span><span class="br">{</span>Test Chapter <span class="brx">#</span>1<span class="br">}</span>
  Chapter <span class="cs"><span class="systemcs">\someheadnumber</span></span><span class="brx">[</span>chapter<span class="brx">]</span><span class="brx">[</span>current<span class="brx">]</span> of
  <span class="cs"><span class="systemcs">\someheadnumber</span></span><span class="brx">[</span>chapter<span class="brx">]</span><span class="brx">[</span>last<span class="brx">]</span>
  <span class="cs"><span class="systemcs">\dorecurse</span></span><span class="br">{</span>9<span class="br">}</span><span class="br">{</span><span class="cs"><span class="documentcs">\section</span></span><span class="br">{</span>Test Section<span class="br">}</span>
    Section <span class="cs"><span class="systemcs">\someheadnumber</span></span><span class="brx">[</span>section<span class="brx">]</span><span class="brx">[</span>current<span class="brx">]</span> of
    <span class="cs"><span class="systemcs">\someheadnumber</span></span><span class="brx">[</span>section<span class="brx">]</span><span class="brx">[</span>last<span class="brx">]</span> <span class="cs"><span class="documentcs">\blank</span></span>
    <span class="cs">\fakewords</span><span class="br">{</span>10<span class="br">}</span><span class="br">{</span>20<span class="br">}</span> <span class="cs">\par</span>
  <span class="br">}</span>
<span class="br">}</span>
<span class="cs"><span class="documentcs">\stoptext</span></span>
</pre>
     </li>
     <li class="rendering">
      <img height="1754" src="../../wikiteximage/f9598dd57fec471a2817ea2e6e2b10d6.webp" width="1240">
     </li>
    </ul>
   </div>
  </article>
  <footer>
   <ul role="list">
    <li>
     <a href="../../index.html">
      Home
     </a>
    </li>
    <li>
     Mirrored on 2026-01-16
    </li>
    <li>
     <a href="http://www.gnu.org/copyleft/fdl.html" rel="license">
      GFDL 1.2
     </a>
    </li>
    <li>
     <a href="https://wiki.contextgarden.net/Graphics_and_media/Boxes_and_stacking_mechanisms/Thumb_index">
      Original page
     </a>
    </li>
   </ul>
  </footer>
 </body>
</html>
