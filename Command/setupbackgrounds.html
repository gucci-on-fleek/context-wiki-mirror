<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <link href="../style.css" rel="stylesheet">
  <link href="../favicon.ico" rel="icon" sizes="32x32">
  <title>
   Command/setupbackgrounds&mdash;ConTeXt Wiki Mirror
  </title>
  <link href="https://wiki.contextgarden.net/Command/setupbackgrounds" rel="canonical">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="#241504" name="theme-color">
  <meta content="light dark" name="color-scheme">
 </head>
 <body>
  <header>
   <h1 id="page-title">
    Command/setupbackgrounds
   </h1>
   <p>Unofficial <a href="https://wiki.contextgarden.net/">ConTeXt Wiki</a> mirror</p>
   <p>Last modified: <a href="https://wiki.contextgarden.net/index.php?curid=3053&diff=38092">2025-01-05</a>
        </p>
  </header>
  <article>
   <div class="mw-parser-output">
    <h2>
     <span id="Syntax_(autogenerated)">
     </span>
     <span class="mw-headline" id="Syntax_.28autogenerated.29">
      <a class="mw-redirect" href="../Help:Reference.html" title="Help:Reference">
       Syntax
      </a>
      (autogenerated)
     </span>
    </h2>
    <table cellpadding="3" cellspacing="4" class="cmd">
     <tbody>
      <tr>
       <td class="cmd" colspan="2">\setupbackgrounds<span class="arg1">[...,...]</span><span class="arg2"><i>[...,...]</i></span><span class="arg3">[...=...,...]</span></td>
      </tr>
      <tr class="arg1" valign="top">
       <td class="cmd">[...,...]</td>
       <td>top header text footer bottom </td>
      </tr>
      <tr class="arg2" valign="top">
       <td class="cmd">[...,...]</td>
       <td>leftedge leftmargin text rightmargin rightedge </td>
      </tr>
      <tr class="arg3" valign="top">
       <td class="cmd">...=...,...</td>
       <td><i>inherits from</i> <a class="cmdref" href="setupframed.html" title="Command/setupframed">\setupframed</a></td>
      </tr>
     </tbody>
    </table>
    <table cellpadding="3" cellspacing="4" class="cmd">
     <tbody>
      <tr>
       <td class="cmd" colspan="2">\setupbackgrounds<span class="arg1"><i>[...,...]</i></span><span class="arg2">[...=...,...]</span></td>
      </tr>
      <tr class="arg1" valign="top">
       <td class="cmd">[...,...]</td>
       <td>paper page leftpage rightpage text hidden </td>
      </tr>
      <tr class="arg2" valign="top">
       <td class="cmd">state</td>
       <td><b>start</b> stop </td>
      </tr>
      <tr class="arg2" valign="top">
       <td class="cmd">...=...,...</td>
       <td><i>inherits from</i> <a class="cmdref" href="setupframed.html" title="Command/setupframed">\setupframed</a></td>
      </tr>
     </tbody>
    </table>
    <h2>
     <span class="mw-headline" id="Syntax">
      <a class="mw-redirect" href="../Help:Reference.html" title="Help:Reference">
       Syntax
      </a>
     </span>
    </h2>
    <table cellpadding="2" cellspacing="4" class="cmd">
     <tbody>
      <tr>
       <td class="cmd" colspan="2">\setupbackgrounds<span class="first" style="color:red;">[...]</span><span class="second" style="color:red;">[...,...,...]</span><span class="third">[...,...=...,...]</span></td>
      </tr>
      <tr class="first" valign="top">
       <td class="cmd">[...]</td>
       <td>top header text footer bottom page paper leftpage rightpage </td>
      </tr>
      <tr class="second" valign="top">
       <td class="cmd">[...,...,...]</td>
       <td>leftedge leftmargin text rightmargin rightedge </td>
      </tr>
      <tr class="third" valign="top">
       <td class="cmd"><a class="new" href="../index.php?title=Command/keyword:state&action=edit&redlink=1.html" title="Command/keyword:state (page does not exist)">state</a></td>
       <td><a class="new" href="../index.php?title=Command/value:start&action=edit&redlink=1.html" title="Command/value:start (page does not exist)">start</a> <a class="new" href="../index.php?title=Command/value:stop&action=edit&redlink=1.html" title="Command/value:stop (page does not exist)">stop</a> <a class="new" href="../index.php?title=Command/value:repeat&action=edit&redlink=1.html" title="Command/value:repeat (page does not exist)">repeat</a> </td>
      </tr>
      <tr class="third" valign="top">
       <td class="cmd">[...,...=...,...]</td>
       <td>see <a href="setupframed.html" title="Command/setupframed">\setupframed</a> </td>
      </tr>
     </tbody>
    </table>
    <h2>
     <span class="mw-headline" id="Description">
      Description
     </span>
    </h2>
    <p><tt><a class="mw-selflink selflink">\setupbackgrounds</a></tt> is used to draw frames or backgrounds that cover specific areas of the page, under the text layer.
</p>
    <ul>
     <li>
      The first parameter sets the main layout area;
     </li>
     <li>
      the optional second one specifies the linked subarea(s) of the prior. Not all main areas have such subareas.
     </li>
     <li>
      about the third parameter
      <ul>
       <li>
        the key
        <code>state</code>
        determines when the page background is recalculated.
        <ul>
         <li>
          <code>state=repeat</code>
          ensures that the page background is always recalculated (useful if you want to use a variable that depends on the current page, such as its number with
          <tt>
           <a class="new" href="../index.php?title=Command/realpageno&action=edit&redlink=1.html" title="Command/realpageno (page does not exist)">
            \realpageno
           </a>
          </tt>
          ).
         </li>
         <li>
          <code>state=start</code>
          recalculates the page background, and stops its automatic recalculation,
         </li>
         <li>
          <code>state=stop</code>
          doesn't recalculate the page background, and stops its automatic recalculation.
         </li>
        </ul>
       </li>
      </ul>
     </li>
    </ul>
    <p>Because <tt><a href="showframe.html" title="Command/showframe">\showframe</a></tt> and <tt><a class="mw-selflink selflink">\setupbackgrounds</a></tt> both draw frameboxes over parts of the page, the order in which they are invoked matters. In most cases, <tt><a class="mw-selflink selflink">\setupbackgrounds</a></tt> should come last.
</p>
    <p>Backgrounds are essential for working with <a href="../Document_layout_and_layers/Layers.html" title="Document layout and layers/Layers">Layers</a>. You enable your defined layers like <code>\setupbackgrounds[page][background=mylayer]</code>.
</p>
    <p>The <code>background</code> key also takes a list, and if you include "foreground", you can also set something on top of your general content, e.g. <code>\setupbackgrounds[page][background={mybacklayer,foreground,mytoplayer}]</code>.
</p>
    <h2>
     <span class="mw-headline" id="Example">
      Example
     </span>
    </h2>
    <ul class="demo">
     <li class="code">
      <pre class="tex"><span class="cs"><span class="stylecs">\setuppapersize</span></span><span class="brx">[</span>A7<span class="brx">]</span>
<span class="cs"><span class="documentcs">\showframe</span></span>

<span class="comment">% \setupbackgrounds should be placed *after* \showframe, </span>

<span class="cs"><span class="stylecs">\setupbackgrounds</span></span> <span class="brx">[</span>footer<span class="brx">]</span>                <span class="brx">[</span>background<span class="brx">=</span>color, backgroundcolor<span class="brx">=</span>blue<span class="brx">]</span>
<span class="cs"><span class="stylecs">\setupbackgrounds</span></span> <span class="brx">[</span>footer<span class="brx">]</span>  <span class="brx">[</span>leftmargin<span class="brx">]</span>  <span class="brx">[</span>background<span class="brx">=</span>color, backgroundcolor<span class="brx">=</span>red<span class="brx">]</span>
<span class="cs"><span class="stylecs">\setupbackgrounds</span></span> <span class="brx">[</span>text<span class="brx">]</span>                  <span class="brx">[</span>background<span class="brx">=</span>color, backgroundcolor<span class="brx">=</span>lightgray<span class="brx">]</span>
<span class="cs"><span class="stylecs">\setupbackgrounds</span></span> <span class="brx">[</span>text<span class="brx">]</span>    <span class="brx">[</span>rightmargin<span class="brx">]</span> <span class="brx">[</span>background<span class="brx">=</span>color, backgroundcolor<span class="brx">=</span>yellow<span class="brx">]</span>

<span class="cs"><span class="documentcs">\starttext</span></span>
I paint modern
<span class="cs"><span class="documentcs">\stoptext</span></span>
</pre>
     </li>
     <li class="rendering">
      <img height="620" src="../wikiteximage/96be011115f5fcb4d274280aa1b0d981.webp" width="438">
     </li>
    </ul>
    <h3>
     <span class="mw-headline" id="Example_of_dynamic_positioning_of_page_numbering">
      Example of dynamic positioning of page numbering
     </span>
    </h3>
    <ul class="demo">
     <li class="code">
      <pre class="tex"><span class="cs"><span class="stylecs">\setuppapersize</span></span><span class="brx">[</span>A6<span class="brx">]</span><span class="brx">[</span>A6<span class="brx">]</span>
<span class="cs"><span class="stylecs">\setupbackgrounds</span></span><span class="brx">[</span>state<span class="brx">=</span>repeat<span class="brx">]</span>
<span class="comment">%\showframe</span>
<span class="cs"><span class="stylecs">\startuseMPgraphic</span></span><span class="br">{</span>MonGraphismeV_MP<span class="br">}</span>
  numeric h&nbsp;; h&nbsp;:<span class="brx">=</span> <span class="cs"><span class="systemcs">\overlayheight</span></span>&nbsp;;
  numeric w&nbsp;; w&nbsp;:<span class="brx">=</span> <span class="cs"><span class="systemcs">\overlaywidth</span></span>&nbsp;;
  numeric n&nbsp;; n&nbsp;:<span class="brx">=</span> <span class="cs">\number</span><span class="cs">\realpageno</span>&nbsp;;
  numeric m&nbsp;; m&nbsp;:<span class="brx">=</span> <span class="cs">\number</span><span class="cs">\lastpageno</span>&nbsp;;
  numeric ratio&nbsp;; ratio&nbsp;:<span class="brx">=</span> <span class="brx">(</span>1-n/<span class="brx">(</span>m+1<span class="brx">)</span><span class="brx">)</span>;
  numeric e&nbsp;; e&nbsp;:<span class="brx">=</span> 0.3mm;

  picture pa&nbsp;; pa&nbsp;:<span class="brx">=</span> textext.raw<span class="brx">(</span>btex <span class="br">{</span><span class="cs"><span class="stylecs">\strut</span></span><span class="cs">\the</span><span class="cs">\realpageno</span><span class="br">}</span> etex<span class="brx">)</span>&nbsp;;
  numeric wpa&nbsp;; wpa&nbsp;:<span class="brx">=</span> xpart <span class="brx">(</span>urcorner pa - ulcorner pa<span class="brx">)</span>;
  numeric hpa&nbsp;; hpa&nbsp;:<span class="brx">=</span> ypart <span class="brx">(</span>ulcorner pa - llcorner pa<span class="brx">)</span>;

  pa&nbsp;:<span class="brx">=</span> pa shifted <span class="brx">(</span>-wpa/2 + w/2, ratio * <span class="brx">(</span>h-hpa<span class="brx">)</span><span class="brx">)</span>;
  pair paA&nbsp;; paA:<span class="brx">=</span> <span class="brx">(</span><span class="brx">(</span>ulcorner pa<span class="brx">)</span> + <span class="brx">(</span>urcorner pa<span class="brx">)</span><span class="brx">)</span> / 2&nbsp;;
  pair paB&nbsp;; paB:<span class="brx">=</span> <span class="brx">(</span><span class="brx">(</span>llcorner pa<span class="brx">)</span> + <span class="brx">(</span>lrcorner pa<span class="brx">)</span><span class="brx">)</span> / 2&nbsp;;

  draw <span class="brx">(</span><span class="brx">(</span>w/2,0<span class="brx">)</span>--paB<span class="brx">)</span> dashed withdots withpen pencircle scaled e withcolor darkred;
  draw <span class="brx">(</span><span class="brx">(</span>w/2,h<span class="brx">)</span>--paA<span class="brx">)</span> dashed withdots withpen pencircle scaled e withcolor darkred;
  draw pa withcolor darkred;
<span class="cs"><span class="stylecs">\stopuseMPgraphic</span></span>

<span class="cs"><span class="stylecs">\startuseMPgraphic</span></span><span class="br">{</span>MonGraphismeH_MP<span class="br">}</span>
  numeric h&nbsp;; h&nbsp;:<span class="brx">=</span> <span class="cs"><span class="systemcs">\overlayheight</span></span>&nbsp;;
  numeric w&nbsp;; w&nbsp;:<span class="brx">=</span> <span class="cs"><span class="systemcs">\overlaywidth</span></span>&nbsp;;
  numeric n&nbsp;; n&nbsp;:<span class="brx">=</span> <span class="cs">\number</span><span class="cs">\realpageno</span>&nbsp;;
  numeric m&nbsp;; m&nbsp;:<span class="brx">=</span> <span class="cs">\number</span><span class="cs">\lastpageno</span>&nbsp;;
  numeric ratio&nbsp;; ratio&nbsp;:<span class="brx">=</span> <span class="brx">(</span>n/<span class="brx">(</span>m+1<span class="brx">)</span><span class="brx">)</span>;
  numeric e&nbsp;; e&nbsp;:<span class="brx">=</span> 0.3mm;

  picture pa&nbsp;; pa&nbsp;:<span class="brx">=</span> textext.raw<span class="brx">(</span>btex <span class="br">{</span><span class="cs"><span class="stylecs">\strut</span></span><span class="cs">\the</span><span class="cs">\realpageno</span><span class="br">}</span> etex<span class="brx">)</span>&nbsp;;
  numeric wpa&nbsp;; wpa&nbsp;:<span class="brx">=</span> xpart <span class="brx">(</span>urcorner pa - ulcorner pa<span class="brx">)</span>;
  numeric hpa&nbsp;; hpa&nbsp;:<span class="brx">=</span> ypart <span class="brx">(</span>ulcorner pa - llcorner pa<span class="brx">)</span>;

  pa&nbsp;:<span class="brx">=</span> pa shifted <span class="brx">(</span>ratio * <span class="brx">(</span>w-wpa<span class="brx">)</span>,-hpa/2 + h/2<span class="brx">)</span>;
  pair paA&nbsp;; paA:<span class="brx">=</span> <span class="brx">(</span><span class="brx">(</span>ulcorner pa<span class="brx">)</span> + <span class="brx">(</span>llcorner pa<span class="brx">)</span><span class="brx">)</span> / 2&nbsp;;
  pair paB&nbsp;; paB:<span class="brx">=</span> <span class="brx">(</span><span class="brx">(</span>urcorner pa<span class="brx">)</span> + <span class="brx">(</span>lrcorner pa<span class="brx">)</span><span class="brx">)</span> / 2&nbsp;;

  draw <span class="brx">(</span><span class="brx">(</span>0,h/2<span class="brx">)</span>--paA<span class="brx">)</span> dashed withdots withpen pencircle scaled e withcolor darkred;
  draw <span class="brx">(</span><span class="brx">(</span>w,h/2<span class="brx">)</span>--paB<span class="brx">)</span> dashed withdots withpen pencircle scaled e withcolor darkred;
  draw pa withcolor darkred;
<span class="cs"><span class="stylecs">\stopuseMPgraphic</span></span>

<span class="cs"><span class="stylecs">\defineoverlay</span></span> <span class="brx">[</span>MonGraphismeV_OL<span class="brx">]</span> <span class="brx">[</span><span class="cs"><span class="stylecs">\useMPgraphic</span></span><span class="br">{</span>MonGraphismeV_MP<span class="br">}</span><span class="brx">]</span>
<span class="cs"><span class="stylecs">\defineoverlay</span></span> <span class="brx">[</span>MonGraphismeH_OL<span class="brx">]</span> <span class="brx">[</span><span class="cs"><span class="stylecs">\useMPgraphic</span></span><span class="br">{</span>MonGraphismeH_MP<span class="br">}</span><span class="brx">]</span>

<span class="cs"><span class="stylecs">\setupbackgrounds</span></span> <span class="brx">[</span>text<span class="brx">]</span>   <span class="brx">[</span>rightmargin<span class="brx">]</span> <span class="brx">[</span>background<span class="brx">=</span><span class="br">{</span>MonGraphismeV_OL<span class="br">}</span><span class="brx">]</span>
<span class="cs"><span class="stylecs">\setupbackgrounds</span></span> <span class="brx">[</span>footer<span class="brx">]</span> <span class="brx">[</span>text<span class="brx">]</span>        <span class="brx">[</span>background<span class="brx">=</span><span class="br">{</span>MonGraphismeH_OL<span class="br">}</span><span class="brx">]</span>

<span class="cs"><span class="documentcs">\starttext</span></span>

<span class="cs"><span class="systemcs">\dorecurse</span></span><span class="br">{</span>4<span class="br">}</span><span class="br">{</span><span class="cs"><span class="documentcs">\input</span></span> tufte<span class="cs"><span class="documentcs">\page</span></span><span class="br">}</span>

<span class="cs"><span class="documentcs">\stoptext</span></span>
</pre>
     </li>
     <li class="rendering">
      <img height="874" src="../wikiteximage/b8aa048b9208c9733a7af13ce3513003.webp" width="620">
     </li>
    </ul>
    <h2>
     <span class="mw-headline" id="See_also">
      See also
     </span>
    </h2>
    <ul>
     <li>
      <a href="../Document_layout_and_layers/Layers.html" title="Document layout and layers/Layers">
       Layers
      </a>
     </li>
     <li>
      <tt>
       <a href="setupframed.html" title="Command/setupframed">
        \setupframed
       </a>
      </tt>
      , which is the mechanism used by \setupbackgrounds.
     </li>
    </ul>
    <h2>
     <span id="Help_from_ConTeXt-Mailinglist/Forum">
     </span>
     <span class="mw-headline" id="Help_from_ConTeXt-Mailinglist.2FForum">
      Help from ConTeXt-Mailinglist/Forum
     </span>
    </h2>
    <p>All issues with:
</p>
    <ul>
     <li>
      <a class="external text" href="http://www.mail-archive.com/search?l=ntg-context%40ntg.nl&q=setupbackgrounds+sort:newest" rel="nofollow">
       setupbackgrounds on the mailing list (all results)
      </a>
     </li>
     <li>
      <a class="external text" href="http://www.mail-archive.com/search?l=ntg-context%40ntg.nl&q=subject:setupbackgrounds+sort:newest" rel="nofollow">
       setupbackgrounds on the mailing list (subject only)
      </a>
     </li>
     <li>
      <a class="external text" href="https://tex.stackexchange.com/search?q=%5Bcontext%5D+setupbackgrounds" rel="nofollow">
       setupbackgrounds on stack exchange
      </a>
     </li>
     <li>
      <a class="external text" href="http://source.contextgarden.net/?search=setupbackgrounds" rel="nofollow">
       setupbackgrounds in ConTeXt's source
      </a>
     </li>
    </ul>
   </div>
  </article>
  <footer>
   <ul role="list">
    <li>
     <a href="../index.html">
      Home
     </a>
    </li>
    <li>
     Mirrored on 2026-01-15
    </li>
    <li>
     <a href="http://www.gnu.org/copyleft/fdl.html" rel="license">
      GFDL 1.2
     </a>
    </li>
    <li>
     <a href="https://wiki.contextgarden.net/Command/setupbackgrounds">
      Original page
     </a>
    </li>
   </ul>
  </footer>
 </body>
</html>
