<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <link href="../../style.css" rel="stylesheet">
  <link href="../../favicon.ico" rel="icon" sizes="32x32">
  <title>
   ConTeXt and Lua programming/Tutorials/starttexdefinition&mdash;ConTeXt Wiki Mirror
  </title>
  <link href="https://wiki.contextgarden.net/ConTeXt_and_Lua_programming/Tutorials/starttexdefinition" rel="canonical">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="#241504" name="theme-color">
  <meta content="light dark" name="color-scheme">
 </head>
 <body>
  <header>
   <h1 id="page-title">
    ConTeXt and Lua programming/Tutorials/starttexdefinition
   </h1>
   <p>Unofficial <a href="https://wiki.contextgarden.net/">ConTeXt Wiki</a> mirror</p>
   <p>Last modified: <a href="https://wiki.contextgarden.net/index.php?curid=4805&diff=40884">2025-01-16</a>
        </p>
  </header>
  <article>
   <div class="mw-parser-output">
    <h2>
     <span id="Syntax_(autogenerated)">
     </span>
     <span class="mw-headline" id="Syntax_.28autogenerated.29">
      <a class="mw-redirect" href="../../Help:Reference.html" title="Help:Reference">
       Syntax
      </a>
      (autogenerated)
     </span>
    </h2>
    <table cellpadding="3" cellspacing="4" class="cmd">
     <tbody>
      <tr>
       <td class="cmd" colspan="2">\starttexdefinition<span class="arg1"><i> ... </i></span><span class="arg2"><i> ... </i></span><span class="arg3"><i> ... </i></span><span class="arg4"><i> ... </i></span><span class="arg5"><i> ... </i></span><span class="arg6"> ... </span><span class="arg7"><i> ... </i></span> ... \stoptexdefinition</td>
      </tr>
      <tr class="arg1" valign="top">
       <td class="cmd"> ... </td>
       <td>spaces nospaces </td>
      </tr>
      <tr class="arg2" valign="top">
       <td class="cmd"> ... </td>
       <td>global </td>
      </tr>
      <tr class="arg3" valign="top">
       <td class="cmd"> ... </td>
       <td>unexpanded </td>
      </tr>
      <tr class="arg4" valign="top">
       <td class="cmd"> ... </td>
       <td>expanded </td>
      </tr>
      <tr class="arg5" valign="top">
       <td class="cmd"> ... </td>
       <td>singleempty doubleempty tripleempty quadrupleempty quintupleempty sixtupleempty singleargument doubleargument tripleargument quadrupleargument quintupleargument sixtupleargument </td>
      </tr>
      <tr class="arg6" valign="top">
       <td class="cmd"> ... </td>
       <td><a class="cmdvalue" href="../../Commandvalue/name.html" title="Commandvalue/name">name</a> </td>
      </tr>
      <tr class="arg7" valign="top">
       <td class="cmd"> ... </td>
       <td><a class="cmdvalue" href="../../Commandvalue/template.html" title="Commandvalue/template">template</a> </td>
      </tr>
     </tbody>
    </table>
    <h2>
     <span class="mw-headline" id="Syntax">
      <a class="mw-redirect" href="../../Help:Reference.html" title="Help:Reference">
       Syntax
      </a>
     </span>
    </h2>
    <table cellpadding="2" cellspacing="4" class="cmd">
     <tbody>
      <tr>
       <td class="cmd" colspan="2">\starttexdefinition
      <span class="first" style="color:red;"> ... </span><span class="second"> ... </span><span class="third"> ... </span><span class="fourth">command</span><span class="fifth"> ... </span></td>
      </tr>
      <tr class="first" valign="top">
       <td class="cmd">...</td>
       <td>global (optional)</td>
      </tr>
      <tr class="second" valign="top">
       <td class="cmd">...</td>
       <td>unexpanded (optional)</td>
      </tr>
      <tr class="third" valign="top">
       <td class="cmd">...</td>
       <td>expanded (optional)</td>
      </tr>
      <tr class="fifth" valign="top">
       <td class="cmd">...</td>
       <td>#arguments</td>
      </tr>
     </tbody>
    </table>
    <h2>
     <span class="mw-headline" id="Description">
      Description
     </span>
    </h2>
    <p>The <code>starttexdefinition</code> uses the <code>start&hellip;stop</code> syntax to define
new control sequences. They directly map to the brace-delimited definitions.
It's also possible to define commands that take arguments. Both, the numbered
syntax and the MkVI name-syntax are supported. To use MkVI syntax, save the
file as <code>file.mkvi</code> or place the line <tt>%% macros=mkvi</tt> at the
beginning of the document. The command features several modifier sequences,
which are demonstrated in the following examples.
</p>
    <h2>
     <span class="mw-headline" id="Example">
      Example
     </span>
    </h2>
    <pre class="tex"><span class="comment">%% \def\command{&hellip;}</span>
<span class="cs"><span class="systemcs">\starttexdefinition</span></span> command
	&hellip;
<span class="cs"><span class="systemcs">\stoptexdefinition</span></span>

<span class="comment">%% \def\command#1#2{&hellip;}</span>
<span class="cs"><span class="systemcs">\starttexdefinition</span></span> command <span class="brx">#</span>1 <span class="brx">#</span>2
	&hellip;
<span class="cs"><span class="systemcs">\stoptexdefinition</span></span>

<span class="comment">%% \def\command#name#options{&hellip;}</span>
<span class="cs"><span class="systemcs">\starttexdefinition</span></span> command <span class="brx">#</span>name <span class="brx">#</span>options
	&hellip;
<span class="cs"><span class="systemcs">\stoptexdefinition</span></span>

<span class="comment">%% \unexpanded\def\command#name#options{&hellip;}</span>
<span class="cs"><span class="systemcs">\starttexdefinition</span></span> unexpanded command <span class="brx">#</span>name <span class="brx">#</span>options
	&hellip;
<span class="cs"><span class="systemcs">\stoptexdefinition</span></span>

<span class="comment">%% \gdef\command{&hellip;}</span>
<span class="cs"><span class="systemcs">\starttexdefinition</span></span> global command
	&hellip;
<span class="cs"><span class="systemcs">\stoptexdefinition</span></span>

<span class="comment">%% \unexpanded\gdef\command{&hellip;}</span>
<span class="cs"><span class="systemcs">\starttexdefinition</span></span> global unexpanded command
	&hellip;
<span class="cs"><span class="systemcs">\stoptexdefinition</span></span>

<span class="comment">%% \unexpanded\edef\command#arg{&hellip;}</span>
<span class="cs"><span class="systemcs">\starttexdefinition</span></span> global unexpanded command <span class="brx">#</span>arg
	&hellip;
<span class="cs"><span class="systemcs">\stoptexdefinition</span></span>

<span class="comment">%% \unexpanded\xdef\command#arg{&hellip;}</span>
<span class="cs"><span class="systemcs">\starttexdefinition</span></span> global unexpanded expanded command <span class="brx">#</span>arg
	&hellip;
<span class="cs"><span class="systemcs">\stoptexdefinition</span></span>
</pre>
    <h2>
     <span class="mw-headline" id="Pitfalls">
      Pitfalls
     </span>
    </h2>
    <p>The order in which the modifier sequences <code>global</code>, <code>unexpanded</code>
and <code>expanded</code> appear matters. One difference between traditional
definitions and the start-stop environment is that spaces are ignored in the
<code>texdefinition</code> environment, so line endings don't have to be littered
with percent signs and the definitions tend to be more readable. This is
usually what is desired when writing macros. However, it has to be taken into
account when encapsulating Lua code.
</p>
    <pre class="tex"><span class="comment">%% no problems here</span>
<span class="cs">\def</span><span class="cs">\somecommand</span>
  <span class="br">{</span><span class="cs"><span class="systemcs">\startluacode</span></span>
    if true then
    else
    end
  <span class="cs"><span class="systemcs">\stopluacode</span></span><span class="br">}</span>

<span class="cs">\somecommand</span>

<span class="comment">%% this will fail</span>
<span class="cs"><span class="systemcs">\starttexdefinition</span></span> somecommand
  <span class="cs"><span class="systemcs">\startluacode</span></span>
    if true then
    else
    end
  <span class="cs"><span class="systemcs">\stopluacode</span></span>
<span class="cs"><span class="systemcs">\stoptexdefinition</span></span>

<span class="cs">\somecommand</span>
</pre>
    <p>The above <code>texdefinition</code> example will fail, since the line endings,
which normally result in a space are ignored and the spaces collapsed, so Lua
receives <code>if true thenelseend</code>, which is not valid. The solution is to
add a space and place a percent sign, which will not be removed in that case.
</p>
    <pre class="tex"><span class="comment">%% this works</span>
<span class="cs"><span class="systemcs">\starttexdefinition</span></span> somecommand
  <span class="cs"><span class="systemcs">\startluacode</span></span>
    if true then <span class="comment">%%</span>
    else <span class="comment">%%</span>
    end
  <span class="cs"><span class="systemcs">\stopluacode</span></span>
<span class="cs"><span class="systemcs">\stoptexdefinition</span></span>

<span class="cs">\somecommand</span>
</pre>
    <h2>
     <span class="mw-headline" id="See_also">
      See also
     </span>
    </h2>
    <ul>
     <li>
      <span class="plainlinks">
       <a class="external text" href="http://www.tug.org/utilities/plain/cseq.html#def-rp" rel="nofollow">
        <tt>
         \def
        </tt>
       </a>
       <span class="plainlinks">
       </span>
      </span>
     </li>
     <li>
      <tt>
       <a href="../../Command/define.html" title="Command/define">
        \define
       </a>
      </tt>
     </li>
    </ul>
    <h2>
     <span id="Help_from_ConTeXt-Mailinglist/Forum">
     </span>
     <span class="mw-headline" id="Help_from_ConTeXt-Mailinglist.2FForum">
      Help from ConTeXt-Mailinglist/Forum
     </span>
    </h2>
    <p>All issues with:
</p>
    <ul>
     <li>
      <a class="external text" href="http://www.mail-archive.com/search?l=ntg-context%40ntg.nl&q=starttexdefinition+sort:newest" rel="nofollow">
       starttexdefinition on the mailing list (all results)
      </a>
     </li>
     <li>
      <a class="external text" href="http://www.mail-archive.com/search?l=ntg-context%40ntg.nl&q=subject:starttexdefinition+sort:newest" rel="nofollow">
       starttexdefinition on the mailing list (subject only)
      </a>
     </li>
     <li>
      <a class="external text" href="https://tex.stackexchange.com/search?q=%5Bcontext%5D+starttexdefinition" rel="nofollow">
       starttexdefinition on stack exchange
      </a>
     </li>
     <li>
      <a class="external text" href="http://source.contextgarden.net/?search=starttexdefinition" rel="nofollow">
       starttexdefinition in ConTeXt's source
      </a>
     </li>
    </ul>
   </div>
  </article>
  <footer>
   <ul role="list">
    <li>
     <a href="../../index.html">
      Home
     </a>
    </li>
    <li>
     Mirrored on 2026-01-16
    </li>
    <li>
     <a href="http://www.gnu.org/copyleft/fdl.html" rel="license">
      GFDL 1.2
     </a>
    </li>
    <li>
     <a href="https://wiki.contextgarden.net/ConTeXt_and_Lua_programming/Tutorials/starttexdefinition">
      Original page
     </a>
    </li>
   </ul>
  </footer>
 </body>
</html>
