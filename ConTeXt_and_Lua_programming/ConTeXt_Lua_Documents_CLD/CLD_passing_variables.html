<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <link href="../../style.css" rel="stylesheet">
  <link href="../../favicon.ico" rel="icon" sizes="32x32">
  <title>
   ConTeXt and Lua programming/ConTeXt Lua Documents CLD/CLD passing variables&mdash;ConTeXt Wiki Mirror
  </title>
  <link href="https://wiki.contextgarden.net/ConTeXt_and_Lua_programming/ConTeXt_Lua_Documents_CLD/CLD_passing_variables" rel="canonical">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="#241504" name="theme-color">
  <meta content="light dark" name="color-scheme">
 </head>
 <body>
  <header>
   <h1 id="page-title">
    ConTeXt and Lua programming/ConTeXt Lua Documents CLD/CLD passing variables
   </h1>
   <p>Unofficial <a href="https://wiki.contextgarden.net/">ConTeXt Wiki</a> mirror</p>
   <p>Last modified: <a href="https://wiki.contextgarden.net/index.php?curid=4992&diff=40523">2025-01-14</a>
        </p>
  </header>
  <article>
   <div class="mw-parser-output">
    <p>CLD (Context Lua Document) is the environment which lets you interact with TeX from inside Lua code. For more informations on this see the manual cld-mkiv.pdf, which is in 
[ConTeXt-StandAlone]/tex/texmf-context/doc/context/documents/general/manuals/cld-mkiv.pdf
inside your ConTeXt directory.
</p>
    <div class="toc" id="toc">
     <input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox">
     <div class="toctitle" dir="ltr" lang="en">
      <h3>
       Contents
      </h3>
      <span class="toctogglespan">
       <label class="toctogglelabel" for="toctogglecheckbox">
       </label>
      </span>
     </div>
     <ul>
      <li class="toclevel-1 tocsection-1">
       <a href="#Macro_arguments_.28parameters.29">
        <span class="tocnumber">
         1
        </span>
        <span class="toctext">
         Macro arguments (parameters)
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-2">
       <a href="#Variables">
        <span class="tocnumber">
         2
        </span>
        <span class="toctext">
         Variables
        </span>
       </a>
       <ul>
        <li class="toclevel-2 tocsection-3">
         <a href="#From_TeX_to_Lua">
          <span class="tocnumber">
           2.1
          </span>
          <span class="toctext">
           From TeX to Lua
          </span>
         </a>
        </li>
        <li class="toclevel-2 tocsection-4">
         <a href="#From_Lua_to_TeX">
          <span class="tocnumber">
           2.2
          </span>
          <span class="toctext">
           From Lua to TeX
          </span>
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <h2>
     <span id="Macro_arguments_(parameters)">
     </span>
     <span class="mw-headline" id="Macro_arguments_.28parameters.29">
      Macro arguments (parameters)
     </span>
    </h2>
    <p>Now if one needs to pass arguments from Lua to a macro command defined in ConTeXt, one has several possibilities.
</p>
    <p>First, if <code>\mycommand</code> is defined on the TeX end and takes one parameter, as in <code>\mycommand{Myvariable</code>}, then in Lua one can say <code>context.mycommand("Myvariable")</code>.
</p>
    <p>The same applies to all the commands which take one or more parameters, provided that in their definition no specific delimiters is used. If <code>\mycommand</code> takes two arguments, then saying <code>context.mycommand("Myfirstargument","Mysecondargument")</code> in the Lua end, results in <code>\mycommand{Myfirstargument}{Mysecondargument</code>} on the TeX end.
</p>
    <p>Next, for commands which use specific delimiters, such as the <code>\MyGoTo</code> command defined below, then one has to use the construction <code>context.MyGoTo({"Myfirstargument"},{"Mysecondargument"})</code>.
</p>
    <p>Finally another construction (which works also for the above cases) which is there more specifically for some Lua reserved words (such as <code>goto, end, if</code>, present also as TeX commands) is to use the construction <code>context["goto"]("some argument",{"ref:somewhere"})</code> in order to obtain <code>\goto{some argument}[ref:somewhere]</code>.
</p>
    <p>All this being said, it is better to give some examples below (try the code by putting and removing the Lua comment signs --) 
</p>
    <ul class="demo">
     <li class="code">
      <pre class="tex"><span class="cs"><span class="stylecs">\setuppapersize</span></span><span class="brx">[</span>A6<span class="brx">]</span><span class="brx">[</span>A6<span class="brx">]</span>
<span class="cs"><span class="stylecs">\setupinteraction</span></span><span class="brx">[</span>state<span class="brx">=</span>start<span class="brx">]</span>
<span class="cs">\def</span><span class="cs">\MyGoTo</span><span class="brx">[</span><span class="brx">#</span>1<span class="brx">]</span><span class="brx">[</span><span class="brx">#</span>2<span class="brx">]</span><span class="br">{</span><span class="cs"><span class="documentcs">\goto</span></span><span class="br">{</span><span class="brx">#</span>1<span class="br">}</span><span class="brx">[</span><span class="brx">#</span>2<span class="brx">]</span><span class="br">}</span>
<span class="cs"><span class="systemcs">\define</span></span><span class="brx">[</span>2<span class="brx">]</span><span class="cs">\YourGoTo</span><span class="br">{</span><span class="cs"><span class="documentcs">\goto</span></span><span class="br">{</span><span class="brx">#</span>1<span class="br">}</span><span class="brx">[</span><span class="brx">#</span>2<span class="brx">]</span><span class="br">}</span>
<span class="cs"><span class="documentcs">\startTEXpage</span></span><span class="brx">[</span>offset<span class="brx">=</span>5mm<span class="brx">]</span>

<span class="cs"><span class="documentcs">\startchapter</span></span><span class="brx">[</span>title<span class="brx">=</span><span class="br">{</span>Ward<span class="br">}</span>,reference<span class="brx">=</span><span class="br">{</span>ch:ward<span class="br">}</span><span class="brx">]</span>

<span class="cs"><span class="systemcs">\startluacode</span></span>
        context.index<span class="brx">(</span>"Knuth"<span class="brx">)</span>
--	context.index<span class="brx">(</span>"Ward"<span class="brx">)</span>
	context<span class="brx">[</span>"index"<span class="brx">]</span><span class="brx">(</span>"Ward"<span class="brx">)</span>
	context<span class="brx">(</span>"Read Knuth and see also the "<span class="brx">)</span>
	local s,t <span class="brx">=</span> "Index","ref:index"
--	context.MyGoTo<span class="brx">(</span><span class="br">{</span>s<span class="br">}</span>,<span class="br">{</span>t<span class="br">}</span><span class="brx">)</span>
	context<span class="brx">[</span>"goto"<span class="brx">]</span><span class="brx">(</span>"Index",<span class="br">{</span>"ref:index"<span class="br">}</span><span class="brx">)</span>
--	context<span class="brx">[</span>"goto"<span class="brx">]</span><span class="brx">(</span>s,<span class="br">{</span>t<span class="br">}</span><span class="brx">)</span>
--	context.YourGoTo<span class="brx">(</span>"Index","ref:index"<span class="brx">)</span>
--	context.YourGoTo<span class="brx">(</span>s,t<span class="brx">)</span>
--	context.goto<span class="brx">(</span>"Index",<span class="br">{</span>"ref:index"<span class="br">}</span><span class="brx">)</span> -- this does not work because goto is a reserved word in Lua
<span class="cs"><span class="systemcs">\stopluacode</span></span>

<span class="cs"><span class="documentcs">\input</span></span> ward.tex

<span class="cs"><span class="documentcs">\stopchapter</span></span>

<span class="cs"><span class="documentcs">\starttitle</span></span><span class="brx">[</span>title<span class="brx">=</span><span class="br">{</span>Index<span class="br">}</span><span class="brx">]</span>
<span class="cs"><span class="systemcs">\startluacode</span></span>
	context.pagereference<span class="brx">(</span><span class="br">{</span>"ref:index"<span class="br">}</span><span class="brx">)</span>
<span class="cs"><span class="systemcs">\stopluacode</span></span>
<span class="cs"><span class="documentcs">\placeindex</span></span>
<span class="cs"><span class="documentcs">\stoptitle</span></span>

<span class="cs"><span class="documentcs">\stopTEXpage</span></span>
</pre>
     </li>
     <li class="rendering">
      <img height="533" src="../../wikiteximage/a9fba4e004609d2299a938edd1e905a5.webp" width="464">
     </li>
    </ul>
    <h2>
     <span class="mw-headline" id="Variables">
      Variables
     </span>
    </h2>
    <p>For setting variables command<tt><a href="../../Command/setvariable.html" title="Command/setvariable">\setvariable</a></tt> is used. One can retrieve the value with <tt><a href="../../Command/getvariable.html" title="Command/getvariable">\getvariable</a></tt>.
</p>
    <h3>
     <span class="mw-headline" id="From_TeX_to_Lua">
      From TeX to Lua
     </span>
    </h3>
    <p>Setting variable on TeX end retrieving it at Lua side:
</p>
    <ul class="demo">
     <li class="code">
      <pre class="tex"><span class="cs"><span class="documentcs">\startTEXpage</span></span><span class="brx">[</span>offset<span class="brx">=</span>5mm<span class="brx">]</span>

<span class="cs"><span class="stylecs">\setvariable</span></span><span class="br">{</span>Namespace<span class="br">}</span><span class="br">{</span>Key<span class="br">}</span><span class="br">{</span>30<span class="br">}</span>

<span class="cs"><span class="systemcs">\startluacode</span></span>
local value <span class="brx">=</span> tokens.getters.macro<span class="brx">(</span>tokens.getters.macro<span class="brx">(</span>"??variables"<span class="brx">)</span> .. "Namespace:Key"<span class="brx">)</span>
value <span class="brx">=</span> 3*value
context<span class="brx">(</span>"Type: " .. type<span class="brx">(</span>value<span class="brx">)</span><span class="brx">)</span>
context.par<span class="brx">(</span><span class="brx">)</span>
context<span class="brx">(</span>"Result is " .. value<span class="brx">)</span>
<span class="cs"><span class="systemcs">\stopluacode</span></span>

<span class="cs"><span class="documentcs">\stopTEXpage</span></span>
</pre>
     </li>
     <li class="rendering">
      <img height="95" src="../../wikiteximage/a6119bbd38274c843d9df2c6384bbcaa.webp" width="173">
     </li>
    </ul>
    <h3>
     <span class="mw-headline" id="From_Lua_to_TeX">
      From Lua to TeX
     </span>
    </h3>
    <p>Setting variable in Lua and retrieving it at TeX side:
</p>
    <ul class="demo">
     <li class="code">
      <pre class="tex"><span class="cs"><span class="documentcs">\startTEXpage</span></span><span class="brx">[</span>offset<span class="brx">=</span>5mm<span class="brx">]</span>

<span class="cs"><span class="systemcs">\startluacode</span></span>
local value <span class="brx">=</span> 30
value <span class="brx">=</span> 3 * value
context<span class="brx">(</span>"Type: " .. type<span class="brx">(</span>value<span class="brx">)</span><span class="brx">)</span>
context.par<span class="brx">(</span><span class="brx">)</span>
context.setvariable<span class="brx">(</span>"Namespace", "Key", value<span class="brx">)</span>
<span class="cs"><span class="systemcs">\stopluacode</span></span>

Result is <span class="cs"><span class="stylecs">\getvariable</span></span><span class="br">{</span>Namespace<span class="br">}</span><span class="br">{</span>Key<span class="br">}</span>.

<span class="cs"><span class="documentcs">\stopTEXpage</span></span>
</pre>
     </li>
     <li class="rendering">
      <img height="95" src="../../wikiteximage/549d37f999f8d1c97bfee1527b904b64.webp" width="173">
     </li>
    </ul>
   </div>
  </article>
  <footer>
   <ul role="list">
    <li>
     <a href="../../index.html">
      Home
     </a>
    </li>
    <li>
     Mirrored on 2026-01-16
    </li>
    <li>
     <a href="http://www.gnu.org/copyleft/fdl.html" rel="license">
      GFDL 1.2
     </a>
    </li>
    <li>
     <a href="https://wiki.contextgarden.net/ConTeXt_and_Lua_programming/ConTeXt_Lua_Documents_CLD/CLD_passing_variables">
      Original page
     </a>
    </li>
   </ul>
  </footer>
 </body>
</html>
