<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <link href="../style.css" rel="stylesheet">
  <link href="../favicon.ico" rel="icon" sizes="32x32">
  <title>
   Color/Color in MetaPost&mdash;ConTeXt Wiki Mirror
  </title>
  <link href="https://wiki.contextgarden.net/Color/Color_in_MetaPost" rel="canonical">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="#241504" name="theme-color">
  <meta content="light dark" name="color-scheme">
 </head>
 <body>
  <header>
   <h1 id="page-title">
    Color/Color in MetaPost
   </h1>
   <p>Unofficial <a href="https://wiki.contextgarden.net/">ConTeXt Wiki</a> mirror</p>
   <p>Last modified: <a href="https://wiki.contextgarden.net/index.php?curid=4632&diff=40145">2025-01-12</a>
        </p>
  </header>
  <article>
   <div class="mw-parser-output">
    <div class="toc" id="toc">
     <input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox">
     <div class="toctitle" dir="ltr" lang="en">
      <h3>
       Contents
      </h3>
      <span class="toctogglespan">
       <label class="toctogglelabel" for="toctogglecheckbox">
       </label>
      </span>
     </div>
     <ul>
      <li class="toclevel-1 tocsection-1">
       <a href="#The_basics">
        <span class="tocnumber">
         1
        </span>
        <span class="toctext">
         The basics
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-2">
       <a href="#Using_colors_defined_in_TeX">
        <span class="tocnumber">
         2
        </span>
        <span class="toctext">
         Using colors defined in TeX
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-3">
       <a href="#Transparent_colors">
        <span class="tocnumber">
         3
        </span>
        <span class="toctext">
         Transparent colors
        </span>
       </a>
       <ul>
        <li class="toclevel-2 tocsection-4">
         <a href="#Troubleshooting_transparency">
          <span class="tocnumber">
           3.1
          </span>
          <span class="toctext">
           Troubleshooting transparency
          </span>
         </a>
        </li>
       </ul>
      </li>
     </ul>
    </div>
    <h2>
     <span class="mw-headline" id="The_basics">
      The basics
     </span>
    </h2>
    <p><a href="../Graphics_and_media/Tutorials/Graphical_programming_with_MetaPost_and_MetaFun.html" title="Graphics and media/Tutorials/Graphical programming with MetaPost and MetaFun">MetaPost</a> only supports the RGB color space, although with the help of <a href="../Graphics_and_media/Tutorials/Graphical_programming_with_MetaPost_and_MetaFun.html" title="Graphics and media/Tutorials/Graphical programming with MetaPost and MetaFun">MetaFun</a> you can face transparency and CMYK colors. This article describes the use of colors in MetaPost and MetaFun.
</p>
    <p>Colors are defined as vectors with three components: a red, green and blue one. Like pens, colors have a <code>with...</code> command:
</p>
    <pre>withcolor (.4,.5,.6)
</pre>
    <p>You can define color variables like so:
</p>
    <pre>color darkred&nbsp;; darkred&nbsp;:= (.625,0,0)&nbsp;;
% use the color
withcolor darkred
% actually, red is already defined, so this works:
withcolor .625red
</pre>
    <p>Because for MetaPost colors are just vectors, you can manipulate them like you would manipulate points. This is a color halfway between red and green:
</p>
    <pre>withcolor .5[red,green]
</pre>
    <h2>
     <span class="mw-headline" id="Using_colors_defined_in_TeX">
      Using colors defined in TeX
     </span>
    </h2>
    <p>In ConTeXt you define colors with <tt><a href="../Command/definecolor.html" title="Command/definecolor">\definecolor</a></tt>. Instead of defining a color a second time in MetaPost, you can use the <code>\MPcolor{colorname}</code> command.
</p>
    <ul class="demosbs">
     <li class="code">
      <pre class="tex"><span class="cs"><span class="stylecs">\setuppapersize</span></span><span class="brx">[</span>A8,landscape<span class="brx">]</span>
<span class="cs"><span class="stylecs">\definecolor</span></span>
  <span class="brx">[</span>darkred<span class="brx">]</span> <span class="brx">[</span>r<span class="brx">=</span>.625<span class="brx">]</span> <span class="comment">% a RGB color</span>
<span class="cs"><span class="stylecs">\definecolor</span></span>
  <span class="brx">[</span>darkgray<span class="brx">]</span><span class="brx">[</span>s<span class="brx">=</span>.625<span class="brx">]</span> <span class="comment">% a gray scale</span>

<span class="cs"><span class="stylecs">\startuseMPgraphic</span></span><span class="br">{</span>color demo<span class="br">}</span>
  pickup pencircle scaled 1mm&nbsp;;
  path p&nbsp;; 
  p&nbsp;:<span class="brx">=</span> fullcircle 
       xscaled 4cm 
       yscaled 3cm&nbsp;;
  fill p withcolor <span class="cs"><span class="stylecs">\MPcolor</span></span><span class="br">{</span>darkgray<span class="br">}</span>&nbsp;;
  draw p withcolor <span class="cs"><span class="stylecs">\MPcolor</span></span><span class="br">{</span>darkred<span class="br">}</span>&nbsp;;
<span class="cs"><span class="stylecs">\stopuseMPgraphic</span></span>

<span class="cs"><span class="documentcs">\starttext</span></span>
<span class="cs"><span class="documentcs">\bold</span></span><span class="br">{</span><span class="cs"><span class="documentcs">\color</span></span><span class="brx">[</span>darkgray<span class="brx">]</span><span class="br">{</span>This<span class="br">}</span>
is an <span class="cs"><span class="documentcs">\color</span></span><span class="brx">[</span>darkred<span class="brx">]</span><span class="br">{</span>ellipse<span class="br">}</span>:<span class="br">}</span><span class="cs">\\</span>
<span class="cs"><span class="stylecs">\useMPgraphic</span></span><span class="br">{</span>color demo<span class="br">}</span>
<span class="cs"><span class="documentcs">\stoptext</span></span>
</pre>
     </li>
     <li class="rendering">
      <img height="307" src="../wikiteximage/d05d85d193af288c166d21fe918e0d57.webp" width="438">
     </li>
    </ul>
    <h2>
     <span class="mw-headline" id="Transparent_colors">
      Transparent colors
     </span>
    </h2>
    <p>You can use transparent colors with the <code>transparent(method, factor, color)</code>  function. For example:
</p>
    <ul class="demosbs">
     <li class="code">
      <pre class="tex"><span class="cs"><span class="stylecs">\setuppapersize</span></span><span class="brx">[</span>A8,landscape<span class="brx">]</span>
<span class="cs"><span class="stylecs">\definecolor</span></span><span class="brx">[</span>highlight<span class="brx">]</span><span class="brx">[</span>r<span class="brx">=</span>0.8,g<span class="brx">=</span>0.8,b<span class="brx">=</span>0<span class="brx">]</span>
<span class="cs"><span class="stylecs">\startuseMPgraphic</span></span><span class="br">{</span>color demo<span class="br">}</span>
  pickup pencircle scaled 1mm&nbsp;;
  path p&nbsp;;
  p:<span class="brx">=</span> fullcircle
       xscaled 4cm
       yscaled 3cm&nbsp;;
  fill p withcolor 
       transparent<span class="brx">(</span>1,0.5,blue<span class="brx">)</span>;
  path pp&nbsp;;
  pp:<span class="brx">=</span> fullcircle
       xscaled 5cm
       yscaled 2cm&nbsp;;
  fill pp withcolor 
       transparent<span class="brx">(</span>1,0.5,<span class="cs"><span class="stylecs">\MPcolor</span></span><span class="br">{</span>highlight<span class="br">}</span><span class="brx">)</span>;
<span class="cs"><span class="stylecs">\stopuseMPgraphic</span></span>

<span class="cs"><span class="documentcs">\starttext</span></span>
<span class="cs"><span class="documentcs">\bold</span></span><span class="br">{</span><span class="cs"><span class="documentcs">\color</span></span><span class="brx">[</span>darkgray<span class="brx">]</span><span class="br">{</span>Here<span class="br">}</span>
are two <span class="cs"><span class="documentcs">\color</span></span><span class="brx">[</span>darkred<span class="brx">]</span><span class="br">{</span>ellipses<span class="br">}</span>:<span class="br">}</span><span class="cs">\\</span>
<span class="cs"><span class="stylecs">\useMPgraphic</span></span><span class="br">{</span>color demo<span class="br">}</span>
<span class="cs"><span class="documentcs">\stoptext</span></span>
</pre>
     </li>
     <li class="rendering">
      <img height="307" src="../wikiteximage/72c82572c959ba6e4351e0eba7ec8b82.webp" width="438">
     </li>
    </ul>
    <p>The available transparency methods are the twelve methods supported by PDF specification:
</p>
    <ul>
     <li>
      1. normal
     </li>
     <li>
      2. multiply
     </li>
     <li>
      3. screen
     </li>
     <li>
      4. overlay
     </li>
     <li>
      5. softlight
     </li>
     <li>
      6. hardlight
     </li>
     <li>
      7. colordodge
     </li>
     <li>
      8. colorburn
     </li>
     <li>
      9. darken
     </li>
     <li>
      10. lighten
     </li>
     <li>
      11. difference
     </li>
     <li>
      12. exclusion
     </li>
    </ul>
    <h3>
     <span class="mw-headline" id="Troubleshooting_transparency">
      Troubleshooting transparency
     </span>
    </h3>
    <p>If you see black colors rather than transparent ones, then you probably hit the 'missing specials' problem. This problem was around in 2006; people may not encounter it anymore, but the solution is mentioned here anyway. From the mailing list:
</p>
    <pre>This all sounds like the 'missing specials' problem that is caused
by conflicting -progname= arguments when using the web2c version
of MetaPost.

Make sure you do not have conflicting memory settings for both
   main_memory.mpost
as well as
   main_memory.metafun

The best is to remove all trace of '.mpost' and '.metafun' memory
settings from your texmf.cnf, but at least make sure all the
'.mpost' and 'metafun' values are the same .

Then regenerate metafun using texexec --make, and all should be
well again.
</pre>
    <p>The settings will be in <code>tex/texmf/web2c/texmf.cnf</code> or <code>tex/texmf-context/web2c/context.cnf</code> inside your ConTeXt tree. If you are using ConTeXt from the Debian/Ubuntu distribution of TeX, instead of via the recommended <a href="../ConTeXt_Standalone.html" title="ConTeXt Standalone">ConTeXt Standalone</a>, you need to edit 
<i>/etc/texmf/texmf.d/95NonPath.cnf</i>, instead. The part you need to edit will look something like this.
</p>
    <pre>main_memory = 1000000&nbsp;% words of inimemory available; also applies to inimf&mp
main_memory.context = 1500000
main_memory.mpost = 1500000
</pre>
    <ul>
     <li>
      Comment out the .mpost line (MetaFun uses the main_memory value of 1000000; the difference in values is the cause of the problem).
     </li>
     <li>
      (If you are not using the standalone, regenerate your TeX with
      <code>sudo update-texmf</code>
      )
     </li>
     <li>
      Lastly, regenerate the MetaFun format with
      <code>texexec --make</code>
      . Transparency should work now.
     </li>
    </ul>
   </div>
  </article>
  <footer>
   <ul role="list">
    <li>
     <a href="../index.html">
      Home
     </a>
    </li>
    <li>
     Mirrored on 2026-01-11
    </li>
    <li>
     <a href="http://www.gnu.org/copyleft/fdl.html" rel="license">
      GFDL 1.2
     </a>
    </li>
    <li>
     <a href="https://wiki.contextgarden.net/Color/Color_in_MetaPost">
      Original page
     </a>
    </li>
   </ul>
  </footer>
 </body>
</html>
