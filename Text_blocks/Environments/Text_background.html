<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <link href="../../style.css" rel="stylesheet">
  <link href="../../favicon.ico" rel="icon" sizes="32x32">
  <title>
   Text blocks/Environments/Text background&mdash;ConTeXt Wiki Mirror
  </title>
  <link href="https://wiki.contextgarden.net/Text_blocks/Environments/Text_background" rel="canonical">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="#241504" name="theme-color">
  <meta content="light dark" name="color-scheme">
 </head>
 <body>
  <header>
   <h1 id="page-title">
    Text blocks/Environments/Text background
   </h1>
   <p>Unofficial <a href="https://wiki.contextgarden.net/">ConTeXt Wiki</a> mirror</p>
   <p>Last modified: <a href="https://wiki.contextgarden.net/index.php?curid=2671&diff=41832">2025-01-20</a>
        </p>
  </header>
  <article>
   <div class="mw-parser-output">
    <table style="background-color:#ddddee;color:#000000;border:1px solid #606060;margin:1em 5% 1em 5%;">
     <tbody>
      <tr>
       <td style="padding:0.5em 0.5em;"><ul class="demo"><li class="rendering"><img height="48" src="../../wikiteximage/d8db8740e408c0191e8d08a98e7da5fa.webp" width="31"></li></ul><br>
</td>
       <td style="padding:0.5em 0.5em;"><b>TODO:</b> Add more examples of usage of textbackgrounds. <i>(See: <a href="../../Category:ToDo.html" title="Category:ToDo">To-Do List</a>)</i>
</td>
      </tr>
     </tbody>
    </table>
    <div class="toc" id="toc">
     <input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox">
     <div class="toctitle" dir="ltr" lang="en">
      <h2>
       Contents
      </h2>
      <span class="toctogglespan">
       <label class="toctogglelabel" for="toctogglecheckbox">
       </label>
      </span>
     </div>
     <ul>
      <li class="toclevel-1 tocsection-1">
       <a href="#Basics">
        <span class="tocnumber">
         1
        </span>
        <span class="toctext">
         Basics
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-2">
       <a href="#Example:_multi-page_backgrounded_text">
        <span class="tocnumber">
         2
        </span>
        <span class="toctext">
         Example: multi-page backgrounded text
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-3">
       <a href="#Background_Offset">
        <span class="tocnumber">
         3
        </span>
        <span class="toctext">
         Background Offset
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-4">
       <a href="#Underlining_with_Text_Backgrounds">
        <span class="tocnumber">
         4
        </span>
        <span class="toctext">
         Underlining with Text Backgrounds
        </span>
       </a>
       <ul>
        <li class="toclevel-2 tocsection-5">
         <a href="#Example:_dashed_underbar">
          <span class="tocnumber">
           4.1
          </span>
          <span class="toctext">
           Example: dashed underbar
          </span>
         </a>
        </li>
       </ul>
      </li>
      <li class="toclevel-1 tocsection-6">
       <a href="#_See_also">
        <span class="tocnumber">
         5
        </span>
        <span class="toctext">
         See also
        </span>
       </a>
      </li>
     </ul>
    </div>
    <h2>
     <span class="mw-headline" id="Basics">
      Basics
     </span>
    </h2>
    <p>Pages, paragraphs, words can have a background color or <a href="../../Graphics_and_media/Boxes_and_stacking_mechanisms/Overlays.html" title="Graphics and media/Boxes and stacking mechanisms/Overlays">Overlays</a>. ConTeXt creates these using <a href="../../Graphics_and_media/Tutorials/Graphical_programming_with_MetaPost_and_MetaFun.html" title="Graphics and media/Tutorials/Graphical programming with MetaPost and MetaFun">Graphical programming with MetaPost and MetaFun</a>.
</p>
    <p>But a usual frame is only one object, its contents can&rsquo;t flow over to the next page.
</p>
    <p>You can use <tt><a href="../../Command/definetextbackground.html" title="Command/definetextbackground">\definetextbackground</a></tt> to define a named text background. The environment is based on <tt><a href="../../Command/framed.html" title="Command/framed">\framed</a></tt> and understands its parameters, but can contain several paragraphs and page breaks.
</p>
    <p>After <code>\definetextbackground[Name]</code> you can use <code>\startName ... \stopName</code> (if there&rsquo;s no name conflict) or <code>\starttextbackground[Name] ... \stoptextbackground</code>. Usually you won&rsquo;t need <tt><a href="../../Command/setuptextbackground.html" title="Command/setuptextbackground">\setuptextbackground</a></tt>.
</p>
    <p>The <code>location</code> parameter changes the behaviour between <code>text</code> (highlighting running text) and <code>paragraph</code> (boxed paragraphs).
</p>
    <p>(See, eventually, the <a class="extiw" href="http://www.pragma-ade.nl/general/manuals/details.pdf" title="manual:details.pdf"> details</a> manual or the <a class="external text" href="https://source.contextgarden.net/tex/context/base/mkiv/anch-bck.mkvi" rel="nofollow">source</a> for further explanations.)
</p>
    <p><br>
<b>Beware</b>: The examples using <tt><a href="../../Command/startnarrower.html" title="Command/startnarrower">\startnarrower</a></tt> may be misleading &ndash; of course you can use <tt><a href="../../Command/startbackground.html" title="Command/startbackground">\startbackground</a></tt> without the <code>narrower</code> environment; it behaves differently without <code>\starttext ... \stoptext</code>.
</p>
    <h2>
     <span class="mw-headline" id="Example:_multi-page_backgrounded_text">
      Example: multi-page backgrounded text
     </span>
    </h2>
    <p>Perhaps one might like to offset examples from the running text, or signal to the reader that the following paragraphs contain secondary, detailed information that is of interest only to the specialists. This can be achieved using textbackground and <tt><a href="../../Command/definetextbackground.html" title="Command/definetextbackground">\definetextbackground</a></tt>.
</p>
    <p>In contrast, <a href="Frames.html" title="Text blocks/Environments/Frames">Frames</a> creates text blocks that do not span columns or pages.
</p>
    <p>In the following example, we also reduce the textwidth and bodyfont size.
</p>
    <ul class="demo">
     <li class="code">
      <pre class="tex"><span class="cs"><span class="stylecs">\definetextbackground</span></span><span class="brx">[</span>secondary<span class="brx">]</span><span class="brx">[</span>
  location<span class="brx">=</span>paragraph,
  background<span class="brx">=</span>color,
  backgroundcolor<span class="brx">=</span>lightgray,
  leftoffset<span class="brx">=</span>.5<span class="cs"><span class="systemcs">\bodyfontsize</span></span>,
  rightoffset<span class="brx">=</span>.5<span class="cs"><span class="systemcs">\bodyfontsize</span></span>,
  topoffset<span class="brx">=</span>.5<span class="cs"><span class="systemcs">\bodyfontsize</span></span>,
  bottomoffset<span class="brx">=</span>.5<span class="cs"><span class="systemcs">\bodyfontsize</span></span>,
  before<span class="brx">=</span><span class="br">{</span><span class="cs"><span class="documentcs">\startnarrower</span></span><span class="cs"><span class="stylecs">\switchtobodyfont</span></span><span class="brx">[</span>small<span class="brx">]</span><span class="br">}</span>,
  after<span class="brx">=</span><span class="br">{</span><span class="cs"><span class="documentcs">\stopnarrower</span></span><span class="br">}</span>,
  frame<span class="brx">=</span>off,<span class="brx">]</span>

<span class="cs"><span class="documentcs">\starttext</span></span>
<span class="cs"><span class="documentcs">\samplefile</span></span><span class="br">{</span>knuth<span class="br">}</span>

<span class="cs">\startsecondary</span>
<span class="cs"><span class="documentcs">\samplefile</span></span><span class="br">{</span>knuth<span class="br">}</span>
<span class="cs">\stopsecondary</span>

<span class="cs"><span class="documentcs">\samplefile</span></span><span class="br">{</span>knuth<span class="br">}</span>
<span class="cs"><span class="documentcs">\stoptext</span></span>
</pre>
     </li>
     <li class="rendering">
      <img height="1240" src="../../wikiteximage/ae4ea0e888cf17b5c90c3dace1fe4f66.webp" width="874">
     </li>
    </ul>
    <h2>
     <span class="mw-headline" id="Background_Offset">
      Background Offset
     </span>
    </h2>
    <p>The options left, right, top, bottomoffset can be replaced by backgroundoffset yielding a different result:
</p>
    <ul class="demo">
     <li class="code">
      <pre class="tex"><span class="cs"><span class="stylecs">\definetextbackground</span></span><span class="brx">[</span>secondary<span class="brx">]</span><span class="brx">[</span>
  location<span class="brx">=</span>paragraph,
  background<span class="brx">=</span>color,
  backgroundcolor<span class="brx">=</span>lightgray,
  backgroundoffset<span class="brx">=</span>.5<span class="cs"><span class="systemcs">\bodyfontsize</span></span>,
  before<span class="brx">=</span><span class="br">{</span><span class="cs"><span class="documentcs">\startnarrower</span></span><span class="cs"><span class="stylecs">\switchtobodyfont</span></span><span class="brx">[</span>small<span class="brx">]</span><span class="br">}</span>,
  after<span class="brx">=</span><span class="br">{</span><span class="cs"><span class="documentcs">\stopnarrower</span></span><span class="br">}</span>,
  frame<span class="brx">=</span>off,<span class="brx">]</span>

<span class="cs"><span class="documentcs">\starttext</span></span>
<span class="cs"><span class="documentcs">\samplefile</span></span><span class="br">{</span>knuth<span class="br">}</span>

<span class="cs">\startsecondary</span>
<span class="cs"><span class="documentcs">\samplefile</span></span><span class="br">{</span>knuth<span class="br">}</span>
<span class="cs">\stopsecondary</span>

<span class="cs"><span class="documentcs">\samplefile</span></span><span class="br">{</span>knuth<span class="br">}</span>
<span class="cs"><span class="documentcs">\stoptext</span></span>
</pre>
     </li>
     <li class="rendering">
      <img height="1240" src="../../wikiteximage/511a99e8c4b52fb8e3be54c0e3eaf73d.webp" width="874">
     </li>
    </ul>
    <h2>
     <span class="mw-headline" id="Underlining_with_Text_Backgrounds">
      Underlining with Text Backgrounds
     </span>
    </h2>
    <p>Underlining is generally frowned upon by experienced TeXnicians. Occasionally,
however, it is necessary and <tt><a class="new" href="../../index.php?title=Command/ul&action=edit&redlink=1.html" title="Command/ul (page does not exist)">\ul</a></tt> or <tt><a class="mw-redirect" href="../../Command/_mathundertextextensible.html" title="Command/underbar">\underbar</a></tt> doesn&rsquo;t do what you want. In those
cases using <tt><a href="../../Command/definetextbackground.html" title="Command/definetextbackground">\definetextbackground</a></tt> for the underlining may also be tried.
</p>
    <ul class="demo">
     <li class="code">
      <pre class="tex"><span class="cs"><span class="stylecs">\definetextbackground</span></span><span class="brx">[</span>underline<span class="brx">]</span>
  <span class="brx">[</span>location<span class="brx">=</span>text,alternative<span class="brx">=</span>1,background<span class="brx">=</span>,frame<span class="brx">=</span>off<span class="brx">]</span>

<span class="cs"><span class="stylecs">\definestartstop</span></span><span class="brx">[</span>underline<span class="brx">]</span>
  <span class="brx">[</span>before<span class="brx">=</span><span class="br">{</span><span class="cs"><span class="documentcs">\starttextbackground</span></span><span class="brx">[</span>underline<span class="brx">]</span><span class="br">}</span>,
   after<span class="brx">=</span><span class="cs"><span class="documentcs">\stoptextbackground</span></span><span class="brx">]</span>

<span class="cs"><span class="documentcs">\startTEXpage</span></span>
An example with <span class="cs">\startunderline</span> underlined<span class="cs">\stopunderline</span>\ text.
<span class="cs"><span class="documentcs">\stopTEXpage</span></span>
</pre>
     </li>
     <li class="rendering">
      <img height="14" src="../../wikiteximage/a477416fff8be200350c1fe3a5390c2f.webp" width="246">
     </li>
    </ul>
    <p>If desired, the location of the line can also be adjusted.
</p>
    <ul class="demo">
     <li class="code">
      <pre class="tex"><span class="cs"><span class="stylecs">\startuseMPgraphic</span></span><span class="br">{</span>mpos:par:columnset<span class="br">}</span> <span class="comment">% Shift underlining down a touch</span>
   <span class="cs">\iftracepositions</span> show_multi_pars <span class="cs">\else</span> draw_multi_pars <span class="cs">\fi</span>&nbsp;;
   path p&nbsp;; p&nbsp;:<span class="brx">=</span> boundingbox currentpicture&nbsp;;
   currentpicture&nbsp;:<span class="brx">=</span> currentpicture shifted <span class="brx">(</span>0,-StrutDepth/3<span class="brx">)</span>&nbsp;;
   setbounds currentpicture to p&nbsp;;
<span class="cs"><span class="stylecs">\stopuseMPgraphic</span></span>

<span class="cs"><span class="stylecs">\definetextbackground</span></span><span class="brx">[</span>underline<span class="brx">]</span>
  <span class="brx">[</span>location<span class="brx">=</span>text,alternative<span class="brx">=</span>1,background<span class="brx">=</span>,frame<span class="brx">=</span>off<span class="brx">]</span>

<span class="cs"><span class="stylecs">\definestartstop</span></span><span class="brx">[</span>underline<span class="brx">]</span>
  <span class="brx">[</span>before<span class="brx">=</span><span class="br">{</span><span class="cs"><span class="documentcs">\starttextbackground</span></span><span class="brx">[</span>underline<span class="brx">]</span><span class="br">}</span>,
   after<span class="brx">=</span><span class="cs"><span class="documentcs">\stoptextbackground</span></span><span class="brx">]</span>

<span class="cs"><span class="documentcs">\startTEXpage</span></span>
An example with <span class="cs">\startunderline</span> underlined<span class="cs">\stopunderline</span>\ text.
<span class="cs"><span class="documentcs">\stopTEXpage</span></span>
</pre>
     </li>
     <li class="rendering">
      <img height="14" src="../../wikiteximage/3f904a3229c3eb6afb6a34b190f55947.webp" width="246">
     </li>
    </ul>
    <h3>
     <span class="mw-headline" id="Example:_dashed_underbar">
      Example: dashed underbar
     </span>
    </h3>
    <p>(by WS, 4/2011)
</p>
    <ul class="demo">
     <li class="code">
      <pre class="tex"><span class="cs"><span class="stylecs">\definetextbackground</span></span>
  <span class="brx">[</span>dashed<span class="brx">]</span>
  <span class="brx">[</span>location<span class="brx">=</span>text,
   framecolor<span class="brx">=</span>black,
   alternative<span class="brx">=</span>1,
   voffset<span class="brx">=</span>-<span class="cs"><span class="systemcs">\strutdp</span></span>,
   background<span class="brx">=</span>,
   frame<span class="brx">=</span>off,
   dash<span class="brx">=</span>1<span class="brx">]</span>

<span class="cs">\startdashed</span>
<span class="cs"><span class="documentcs">\samplefile</span></span><span class="br">{</span>ward<span class="br">}</span>
<span class="cs">\stopdashed</span>
</pre>
     </li>
     <li class="rendering">
      <img height="82" src="../../wikiteximage/dc7e529e278ea7413516b51d1de7a101.webp" width="614">
     </li>
    </ul>
    <h2>
     <span class="mw-headline" id="_See_also">
      See also
     </span>
    </h2>
    <p>And you can also take benefit of <a href="../../Graphics_and_media/Tutorials/Graphical_programming_with_MetaPost_and_MetaFun#Multipage_text_and_nofmultipars.html" title="Graphics and media/Tutorials/Graphical programming with MetaPost and MetaFun">MetaPost and MetaFun features</a>.
</p>
   </div>
  </article>
  <footer>
   <ul role="list">
    <li>
     <a href="../../index.html">
      Home
     </a>
    </li>
    <li>
     Mirrored on 2026-01-15
    </li>
    <li>
     <a href="http://www.gnu.org/copyleft/fdl.html" rel="license">
      GFDL 1.2
     </a>
    </li>
    <li>
     <a href="https://wiki.contextgarden.net/Text_blocks/Environments/Text_background">
      Original page
     </a>
    </li>
   </ul>
  </footer>
 </body>
</html>
