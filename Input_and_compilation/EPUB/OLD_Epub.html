<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8">
  <link href="../../style.css" rel="stylesheet">
  <link href="../../favicon.ico" rel="icon" sizes="32x32">
  <title>
   Input and compilation/EPUB/OLD Epub&mdash;ConTeXt Wiki Mirror
  </title>
  <link href="https://wiki.contextgarden.net/Input_and_compilation/EPUB/OLD_Epub" rel="canonical">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <meta content="#241504" name="theme-color">
  <meta content="light dark" name="color-scheme">
 </head>
 <body>
  <header>
   <h1 id="page-title">
    Input and compilation/EPUB/OLD Epub
   </h1>
   <p>Unofficial <a href="https://wiki.contextgarden.net/">ConTeXt Wiki</a> mirror</p>
   <p>Last modified: <a href="https://wiki.contextgarden.net/index.php?curid=3452&diff=39594">2025-01-12</a>
        </p>
  </header>
  <article>
   <div class="mw-parser-output">
    <table style="background-color:#ddddee;color:#000000;border:1px solid #606060;margin:1em 5% 1em 5%;">
     <tbody>
      <tr>
       <td style="padding:0.5em 0.5em;"><ul class="demo"><li class="rendering"><img height="48" src="../../wikiteximage/d8db8740e408c0191e8d08a98e7da5fa.webp" width="31"></li></ul><br>
</td>
       <td style="padding:0.5em 0.5em;"><b>TODO:</b> Beware, this doesn&rsquo;t fit the current state of export files as of January 2015! <i>(See: <a href="../../Category:ToDo.html" title="Category:ToDo">To-Do List</a>)</i>
</td>
      </tr>
     </tbody>
    </table>
    <p>&lt; <a href="../Export.html" title="Input and compilation/Export">Export</a> | <a href="../EPUB.html" title="Input and compilation/EPUB">New ePub docs</a> &gt;
</p>
    <div class="toc" id="toc">
     <input class="toctogglecheckbox" id="toctogglecheckbox" role="button" style="display:none" type="checkbox">
     <div class="toctitle" dir="ltr" lang="en">
      <h2>
       Contents
      </h2>
      <span class="toctogglespan">
       <label class="toctogglelabel" for="toctogglecheckbox">
       </label>
      </span>
     </div>
     <ul>
      <li class="toclevel-1 tocsection-1">
       <a href="#Minimal_example">
        <span class="tocnumber">
         1
        </span>
        <span class="toctext">
         Minimal example
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-2">
       <a href="#More_information">
        <span class="tocnumber">
         2
        </span>
        <span class="toctext">
         More information
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-3">
       <a href="#Export">
        <span class="tocnumber">
         3
        </span>
        <span class="toctext">
         Export
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-4">
       <a href="#The_example_file">
        <span class="tocnumber">
         4
        </span>
        <span class="toctext">
         The example file
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-5">
       <a href="#Additional_tagging">
        <span class="tocnumber">
         5
        </span>
        <span class="toctext">
         Additional tagging
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-6">
       <a href="#Document_styling">
        <span class="tocnumber">
         6
        </span>
        <span class="toctext">
         Document styling
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-7">
       <a href="#Mtxrun">
        <span class="tocnumber">
         7
        </span>
        <span class="toctext">
         Mtxrun
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-8">
       <a href="#Tools">
        <span class="tocnumber">
         8
        </span>
        <span class="toctext">
         Tools
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-9">
       <a href="#Current_Issues">
        <span class="tocnumber">
         9
        </span>
        <span class="toctext">
         Current Issues
        </span>
       </a>
      </li>
      <li class="toclevel-1 tocsection-10">
       <a href="#Latest_news">
        <span class="tocnumber">
         10
        </span>
        <span class="toctext">
         Latest news
        </span>
       </a>
      </li>
     </ul>
    </div>
    <h2>
     <span class="mw-headline" id="Minimal_example">
      Minimal example
     </span>
    </h2>
    <p>A minimal example file would be:
</p>
    <pre class="tex"><span class="cs"><span class="stylecs">\setupbackend</span></span><span class="brx">[</span>export<span class="brx">=</span>yes,xhtml<span class="brx">=</span>yes<span class="brx">]</span>

<span class="cs"><span class="stylecs">\mainlanguage</span></span><span class="brx">[</span>de<span class="brx">]</span>
<span class="cs"><span class="documentcs">\language</span></span><span class="brx">[</span>de<span class="brx">]</span>

<span class="cs"><span class="stylecs">\setupexport</span></span>
   <span class="brx">[</span>title<span class="brx">=</span><span class="br">{</span>A nice book<span class="br">}</span>,
    author<span class="brx">=</span><span class="br">{</span>John Doe<span class="br">}</span>,
    firstpage<span class="brx">=</span><span class="br">{</span>huhn.jpg<span class="br">}</span>,
   <span class="brx">]</span>

<span class="cs"><span class="documentcs">\starttext</span></span>
Hello world!
<span class="cs"><span class="documentcs">\stoptext</span></span>
</pre>
    <p>Please note, that a cover image is part of a valid epub file, therefore you should provide one even in the most minimal case. It is called huhn.jpg in this case. Make sure it is in the same directory as you tex file. Now you have to call the script to produce the epub
</p>
    <pre class="tex">mtxrun --script epub --make test_00.specification
</pre>
    <p>assuming that the minimal example tex file is called test_00.tex
</p>
    <h2>
     <span class="mw-headline" id="More_information">
      More information
     </span>
    </h2>
    <p>ConTeXt has preliminary <a class="external text" href="http://en.wikipedia.org/wiki/EPUB" rel="nofollow">epub</a> support starting from <a class="new" href="../../index.php?title=Context_2011.05.18&action=edit&redlink=1" title="Context 2011.05.18 (page does not exist)"> current 2011.05.18</a>. Some problems were fixed end of August 2014, don&rsquo;t use an older version!
</p>
    <p><br>
In order to make an epub (archive) from your ConTeXt source files, you need to:
</p>
    <ol>
     <li>
      enable the export backend in your
      <code>.tex</code>
      file or environment file (see
      <a href="../Project_and_file_management.html" title="Input and compilation/Project and file management">
       Project and file management
      </a>
      )
     </li>
     <li>
      call the appropriate
      <code>mtxrun</code>
      command (with the epub script) shown in the output of a context run or in the log file
     </li>
    </ol>
    <p><br>
<b>Note:</b> There is no support for graphics yet, that will be included in a later version.
</p>
    <p><b>There&rsquo;s also a more extensive <a href="OLD_Epub_Sample.html" title="Input and compilation/EPUB/OLD Epub Sample">old example</a>.</b>
</p>
    <h2>
     <span class="mw-headline" id="Export">
      Export
     </span>
    </h2>
    <p>To enable the export backend, depending on your needs, one of the following lines has to be included at the beginning of the document (before <tt><a href="../../Command/starttext.html" title="Command/starttext">\starttext</a></tt>).
</p>
    <pre class="tex"><span class="cs"><span class="stylecs">\setupbackend</span></span><span class="brx">[</span>export<span class="brx">=</span>yes,xhtml<span class="brx">=</span>yes<span class="brx">]</span>
<span class="cs"><span class="stylecs">\setupbackend</span></span><span class="brx">[</span>export<span class="brx">=</span>yes,xhtml<span class="brx">=</span>whatever.xhtml<span class="brx">]</span>
<span class="cs"><span class="stylecs">\setupbackend</span></span><span class="brx">[</span>export<span class="brx">=</span>yes,css<span class="brx">=</span><span class="br">{</span>whatever.css,somemore.css<span class="br">}</span><span class="brx">]</span>
</pre>
    <p>The backend can export into:
</p>
    <ul>
     <li>
      xml
     </li>
     <li>
      xhtml
     </li>
     <li>
      xhtml+css
     </li>
    </ul>
    <p><i>For making an epub, you need an xhtml export.</i>
</p>
    <p>If you are unsure, which one of the three backend options you should use, use the minimal one:
</p>
    <pre class="tex"><span class="cs"><span class="stylecs">\setupbackend</span></span><span class="brx">[</span>export<span class="brx">=</span>yes,xhtml<span class="brx">=</span>yes<span class="brx">]</span>
</pre>
    <p>When using a css file, images are supported using an extra css file <code>*-images.css</code>. Images with suffix <code>pdf</code> are remapped to <code>svg</code> but <code>png</code> and <code>jpg</code> are passed on.
</p>
    <p>You can add metadata using the following command:
</p>
    <pre class="tex"><span class="cs"><span class="stylecs">\setupexport</span></span>
   <span class="brx">[</span>title<span class="brx">=</span><span class="br">{</span>A nice book<span class="br">}</span>,
    author<span class="brx">=</span><span class="br">{</span>John Doe<span class="br">}</span>,
    firstpage<span class="brx">=</span><span class="br">{</span>huhn.jpg<span class="br">}</span>,
   <span class="brx">]</span>
</pre>
    <h2>
     <span class="mw-headline" id="The_example_file">
      The example file
     </span>
    </h2>
    <p>You can also hook css into the output, see thread: <a class="external text" href="http://www.ntg.nl/pipermail/ntg-context/2011/058907.html" rel="nofollow">ntg-context</a>. The distribution has a test file <code>export-example.tex</code>. This file exports conforming:  
</p>
    <pre class="tex"><span class="cs"><span class="stylecs">\setupbackend</span></span>
   <span class="brx">[</span>export<span class="brx">=</span>export-example.xml,
    xhtml<span class="brx">=</span>export-example.xhtml,
    css<span class="brx">=</span>export-example.css<span class="brx">]</span>
</pre>
    <p>This file shows some of the possibilities. You will notice that it is a rather normal context file. When the file is processed, you can create an epub file with: 
</p>
    <pre class="tex">mtxrun --script epub --make export-example
</pre>
    <h2>
     <span class="mw-headline" id="Additional_tagging">
      Additional tagging
     </span>
    </h2>
    <p>You can mark sections that don't need to be exported: 
</p>
    <pre class="tex"><span class="cs"><span class="documentcs">\startelement</span></span><span class="brx">[</span>ignore<span class="brx">]</span>

   titlepage makeup 

<span class="cs"><span class="documentcs">\stopelement</span></span>
</pre>
    <p>You can also add data: 
</p>
    <pre class="tex"><span class="cs"><span class="documentcs">\settaggedmetadata</span></span><span class="brx">[</span>name<span class="brx">=</span>Me<span class="brx">]</span>

<span class="cs"><span class="documentcs">\startchapter</span></span><span class="brx">[</span>title<span class="brx">=</span>...<span class="brx">]</span>
   ....
<span class="cs"><span class="documentcs">\stopchapter</span></span>
</pre>
    <p>In this case the data will be injected just after the start of the chapter tag. So, if you want to have document level metadata, you need to put the set command before <tt><a href="../../Command/starttext.html" title="Command/starttext">\starttext</a></tt>.
</p>
    <h2>
     <span class="mw-headline" id="Document_styling">
      Document styling
     </span>
    </h2>
    <p>Some style elements are exported to an additional css file and a reference to that file is automatically added. You can exercise some control over the general document rendering: 
</p>
    <pre class="tex"><span class="cs"><span class="stylecs">\setupexport</span></span>
  <span class="brx">[</span>bodyfont<span class="brx">=</span>12pt,
   width<span class="brx">=</span>600pt,
  <span class="comment">%align=flushleft,</span>
   hyphen<span class="brx">=</span>yes<span class="brx">]</span>
</pre>
    <p>The last option makes sure that the export has enough information to do a reasonable hyohenation. Future versions of the exported might provide some more control.
</p>
    <h2>
     <span class="mw-headline" id="Mtxrun">
      Mtxrun
     </span>
    </h2>
    <p>The actual generation of the epub can be triggered with the <code>mtxrun</code> command shown in the output.
</p>
    <p>Example log entry:
</p>
    <pre>...
backend         &gt; export &gt; saving xml data in 'oeps.export
backend         &gt; export &gt; saving css template in 'oeps.template
backend         &gt; export &gt; saving xhtml variant in 'oeps.xhtml
backend         &gt; export &gt; saving specification in 'oeps.specification' (mtxrun --script epub --make oeps.specification)
...
</pre>
    <p>The "oeps" will be replaced with the appropriate name given to the export backend.
</p>
    <p>Therefore, execute:
</p>
    <pre>mtxrun --script epub --make oeps.specification
</pre>
    <p>This will create an <i>oeps.tree</i> folder with an <i>oeps.epub</i> inside it. When pdf images are used and no suitable svg alternative is present inkscape will be used to create the svg file. 
</p>
    <p>More on this on the mailing list, thread starts at: <a class="external text" href="http://www.ntg.nl/pipermail/ntg-context/2011/058996.html" rel="nofollow">ntg-context</a>.
</p>
    <h2>
     <span class="mw-headline" id="Tools">
      Tools
     </span>
    </h2>
    <p>Viewer:
</p>
    <ul>
     <li>
      <a class="external text" href="http://calibre-ebook.com/" rel="nofollow">
       calibre
      </a>
     </li>
     <li>
      <a class="external text" href="http://www.epubread.com/" rel="nofollow">
       EPUBReader for Firefox
      </a>
      (also does mathml)
     </li>
     <li>
      <a class="external text" href="http://www.fbreader.org/" rel="nofollow">
       FBReader
      </a>
     </li>
     <li>
      <i>
       <a class="external text" href="http://www.adobe.com/products/digitaleditions/" rel="nofollow">
        Adobe Digital Editions
       </a>
      </i>
     </li>
    </ul>
    <p>Online:
</p>
    <ul>
     <li>
      <a class="external text" href="http://bookworm.oreilly.com/" rel="nofollow">
       bookworm
      </a>
     </li>
    </ul>
    <p>Editor:
</p>
    <ul>
     <li>
      <a class="external text" href="http://code.google.com/p/sigil/" rel="nofollow">
       sigil
      </a>
     </li>
    </ul>
    <p>Validation:
</p>
    <ul>
     <li>
      <a class="external text" href="http://code.google.com/p/epubcheck/" rel="nofollow">
       EpubCheck
      </a>
     </li>
     <li>
      <a class="external text" href="http://www.amazon.com/gp/feature.html?docId=1000234621" rel="nofollow">
       KindleGen
      </a>
     </li>
    </ul>
    <p>Specification:
</p>
    <ul>
     <li>
      <a class="external text" href="http://idpf.org/epub" rel="nofollow">
       epub 2/3
      </a>
     </li>
    </ul>
    <h2>
     <span class="mw-headline" id="Current_Issues">
      Current Issues
     </span>
    </h2>
    <p>As of 08:41, 16 June 2011 (CEST):
</p>
    <table>
     <tbody>
      <tr style="background:#cccccc;">
       <td>tool</td>
       <td>description</td>
       <td>error</td>
      </tr>
      <tr>
       <td><code><a class="external text" href="https://gist.github.com/1013262" rel="nofollow">mtx-epub.lua</a></code></td>
       <td>OPF 2.0.1</td>
       <td>amazoncover, bookid, id & ncx fix</td>
      </tr>
      <tr>
       <td style="border-top: 1px solid black">epubcheck-1.2</td>
       <td style="border-top: 1px solid black">OPS 2.0.1</td>
       <td style="border-top: 1px solid black"><code>test.xhtml</code>: <code>&lt;document&gt;</code><br>elements from namespace "" are not allowed<br>xhtml DOCTYPE missing, html + body elements</td>
      </tr>
      <tr>
       <td>epubreader</td>
       <td>OPS 2.0.1</td>
       <td>This XML file does not appear to have any style information associated with it.</td>
      </tr>
      <tr>
       <td>kindlegen</td>
       <td>OPS 2.0.1</td>
       <td>No BODY tag found in content file.</td>
      </tr>
     </tbody>
    </table>
    <table>
     <tbody>
      <tr style="background:#cccccc;">
       <td>feature</td>
       <td>description</td>
      </tr>
      <tr>
       <td>metadata</td>
       <td>add author and title to local:package and local:navigation (mtx-epub.lua)</td>
      </tr>
      <tr>
       <td>cover</td>
       <td>add <a class="external text" href="http://code.google.com/p/epubcheck/issues/detail?id=74" rel="nofollow">cover element</a>, 600&times;800 (min. 500) for amazon</td>
      </tr>
      <tr>
       <td>toc</td>
       <td>table of contents is missing</td>
      </tr>
      <tr>
       <td>chapter break</td>
       <td>new title element &rarr; new xhtml</td>
      </tr>
     </tbody>
    </table>
    <h2>
     <span class="mw-headline" id="Latest_news">
      Latest news
     </span>
    </h2>
    <p>(This section is to be integrated in the instructions above.)
</p>
    <p>Now
</p>
    <pre class="tex">   <span class="cs"><span class="stylecs">\setupbackend</span></span>
     <span class="brx">[</span>export<span class="brx">=</span>yes,
      xhtml<span class="brx">=</span>yes,
      css<span class="brx">=</span>export-example.css<span class="brx">]</span>
</pre>
    <p>also exports an html file with all tags being 'div' and the default css has been adapted to support both. The default css still need some work because not all browsers handle these div expressions equally well. The idea is to have a decent looking default as template (one can always overload).
</p>
    <p>--Hans 27 August 2014
</p>
    <p>The problem with an invalid export.xml when using project structure is also fixed since 27 August 2014.
</p>
    <table style="background-color:#ddddee;color:#000000;border:1px solid #606060;margin:1em 5% 1em 5%;">
     <tbody>
      <tr>
       <td style="padding:0.5em 0.5em;"><ul class="demo"><li class="rendering"><img height="48" src="../../wikiteximage/d8db8740e408c0191e8d08a98e7da5fa.webp" width="31"></li></ul><br>
</td>
       <td style="padding:0.5em 0.5em;"><b>TODO:</b> Beware, this doesn&rsquo;t fit the current state of export files as of January 2015! <i>(See: <a href="../../Category:ToDo.html" title="Category:ToDo">To-Do List</a>)</i>
</td>
      </tr>
     </tbody>
    </table>
   </div>
  </article>
  <footer>
   <ul role="list">
    <li>
     <a href="../../index.html">
      Home
     </a>
    </li>
    <li>
     Mirrored on 2026-01-12
    </li>
    <li>
     <a href="http://www.gnu.org/copyleft/fdl.html" rel="license">
      GFDL 1.2
     </a>
    </li>
    <li>
     <a href="https://wiki.contextgarden.net/Input_and_compilation/EPUB/OLD_Epub">
      Original page
     </a>
    </li>
   </ul>
  </footer>
 </body>
</html>
